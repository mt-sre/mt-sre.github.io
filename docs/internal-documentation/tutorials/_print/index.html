<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=/docs/internal-documentation/tutorials/><link rel=alternate type=application/rss+xml href=/docs/internal-documentation/tutorials/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Tutorials | Managed Tenants SRE</title><meta name=description content><meta property="og:title" content="Tutorials"><meta property="og:description" content="Documentation for Managed Tenants SRE at Red Hat"><meta property="og:type" content="website"><meta property="og:url" content="/docs/internal-documentation/tutorials/"><meta property="og:site_name" content="Managed Tenants SRE"><meta itemprop=name content="Tutorials"><meta itemprop=description content="Documentation for Managed Tenants SRE at Red Hat"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tutorials"><meta name=twitter:description content="Documentation for Managed Tenants SRE at Red Hat"><link rel=preload href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css as=style><link href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 613 145" class="redhat-logo" style="margin:0;width:135px" height="145" width="613"><path d="M127.47 83.49c12.51.0 30.61-2.58 30.61-17.46a14 14 0 00-.31-3.42l-7.45-32.36c-1.72-7.12-3.23-10.35-15.73-16.6C124.89 8.69 103.76.5 97.51.5 91.69.5 90 8 83.06 8c-6.68.0-11.64-5.6-17.89-5.6-6 0-9.91 4.09-12.93 12.5.0.0-8.41 23.72-9.49 27.16A6.43 6.43.0 0042.53 44c0 9.22 36.3 39.45 84.94 39.45M160 72.07c1.73 8.19 1.73 9.05 1.73 10.13.0 14-15.74 21.77-36.43 21.77-46.76.03-87.72-27.37-87.72-45.48a18.45 18.45.0 011.51-7.33C22.27 52 .5 55 .5 74.22c0 31.48 74.59 70.28 133.65 70.28 45.28.0 56.7-20.48 56.7-36.65.0-12.72-11-27.16-30.83-35.78" fill="#e00"/><path d="M160 72.07c1.73 8.19 1.73 9.05 1.73 10.13.0 14-15.74 21.77-36.43 21.77-46.76.03-87.72-27.37-87.72-45.48a18.45 18.45.0 011.51-7.33l3.66-9.06a6.43 6.43.0 00-.22 1.9c0 9.22 36.3 39.45 84.94 39.45 12.51.0 30.61-2.58 30.61-17.46a14 14 0 00-.31-3.42z"/><path d="M579.74 92.8c0 11.89 7.15 17.67 20.19 17.67a52.11 52.11.0 0011.89-1.68V95a24.84 24.84.0 01-7.68 1.16c-5.37.0-7.36-1.68-7.36-6.73V68.3h15.56V54.1h-15.56v-18l-17 3.68V54.1h-11.29v14.2h11.25zm-53 .32c0-3.68 3.69-5.47 9.26-5.47a43.12 43.12.0 0110.1 1.26v7.15a21.51 21.51.0 01-10.63 2.63c-5.46.0-8.73-2.1-8.73-5.57m5.2 17.56c6 0 10.84-1.26 15.36-4.31v3.37h16.82V74.08c0-13.56-9.14-21-24.39-21-8.52.0-16.94 2-26 6.1l6.1 12.52c6.52-2.74 12-4.42 16.83-4.42 7 0 10.62 2.73 10.62 8.31v2.73a49.53 49.53.0 00-12.62-1.58c-14.31.0-22.93 6-22.93 16.73.0 9.78 7.78 17.24 20.19 17.24m-92.44-.94h18.09V80.92h30.29v28.82H506V36.12h-18.07v28.29h-30.29V36.12h-18.09zm-68.86-27.9c0-8 6.31-14.1 14.62-14.1A17.22 17.22.0 01397 72.09v19.45A16.36 16.36.0 01385.24 96c-8.2.0-14.62-6.1-14.62-14.09m26.61 27.87h16.83V32.44l-17 3.68v20.93a28.3 28.3.0 00-14.2-3.68c-16.19.0-28.92 12.51-28.92 28.5a28.25 28.25.0 0028.4 28.6 25.12 25.12.0 0014.93-4.83zM320 67c5.36.0 9.88 3.47 11.67 8.83h-23.2C310.15 70.3 314.36 67 320 67m-28.67 15c0 16.2 13.25 28.82 30.28 28.82 9.36.0 16.2-2.53 23.25-8.42l-11.26-10c-2.63 2.74-6.52 4.21-11.14 4.21a14.39 14.39.0 01-13.68-8.83h39.65v-4.23c0-17.67-11.88-30.39-28.08-30.39a28.57 28.57.0 00-29 28.81M262 51.58c6 0 9.36 3.78 9.36 8.31S268 68.2 262 68.2h-17.89V51.58zm-36 58.16h18.09V82.92h13.77l13.89 26.82H292l-16.2-29.45a22.27 22.27.0 0013.88-20.72c0-13.25-10.41-23.45-26-23.45H226z" fill="#fff"/></svg></span><span class=font-weight-bold>Managed Tenants SRE</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/internal-documentation/access/><span>Getting Access</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site‚Ä¶" aria-label="Search this site‚Ä¶" autocomplete=off data-offline-search-index-json-src=/offline-search-index.88cb378063567db1568bf8ea54fe0969.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/internal-documentation/tutorials/>Return to the regular view of this page</a>.</p></div><h1 class=title>Tutorials</h1><ul><li>1: <a href=#pg-5da6968793d1f802cd0b0096fd75b798>Run Hive Locally</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-5da6968793d1f802cd0b0096fd75b798>1 - Run Hive Locally</h1><p>This guide describes how to deploy a Hive environment in your local machine
using <a href=https://kind.sigs.k8s.io/>kind</a>.</p><p>For the managed clusters, this guide covers both
<a href=https://kind.sigs.k8s.io/>kind</a> clusters and
<a href=https://developers.redhat.com/products/codeready-containers/overview>CRC</a>
clusters.</p><h2 id=preparation>Preparation</h2><p>Setup your <code>GOPATH</code>. Add to your <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GOPATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$HOME</span>/go
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>PATH</span><span style=color:#4e9a06>}</span>:<span style=color:#4e9a06>${</span><span style=color:#000>GOPATH</span><span style=color:#4e9a06>}</span>/bin
</span></span></code></pre></div><p>Install <code>kind</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64
</span></span><span style=display:flex><span>~$ chmod +x ./kind
</span></span><span style=display:flex><span>~$ mv ./kind ~/.local/bin/kind
</span></span></code></pre></div><blockquote><p>This guide was created using kind version: <code>kind v0.14.0 go1.18.2 linux/amd64</code></p></blockquote><p>Install the dependencies:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#000>GO111MODULE</span><span style=color:#ce5c00;font-weight:700>=</span>on go get sigs.k8s.io/kustomize/kustomize/v3
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssl
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssljson
</span></span><span style=display:flex><span>~$ go get -u github.com/openshift/imagebuilder/cmd/imagebuilder
</span></span></code></pre></div><p>Clone OLM and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:operator-framework/operator-lifecycle-manager.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> operator-lifecycle-manager
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ git checkout -b v0.21.2 v0.21.2
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ <span style=color:#204a87>cd</span> ..
</span></span></code></pre></div><p>Clone Hive and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:openshift/hive.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$ git checkout 56adaaacf5f8075e3ad0896dac35243a863ec07b
</span></span></code></pre></div><p>Edit the <code>hack/create-kind-cluster.sh</code>, adding the apiServerAddress pointing
to your local <code>docker0</code> bridge IP. This is needed so the Hive cluster, which
runs inside a docker container, can reach the managed cluster, running inside
another docker container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind.x-k8s.io/v1alpha4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>networking</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiServerAddress</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;172.17.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># docker0 bridge IP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>containerdConfigPatches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000;font-weight:700>|-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors.&#34;localhost:${reg_port}&#34;]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      endpoint = [&#34;http://${reg_name}:${reg_port}&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>    
</span></span></span></code></pre></div><h2 id=hive>Hive</h2><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Create the Hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh hive
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span> ‚úì Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> üñº
</span></span><span style=display:flex><span> ‚úì Preparing nodes üì¶
</span></span><span style=display:flex><span> ‚úì Writing configuration üìú
</span></span><span style=display:flex><span> ‚úì Starting control-plane üïπÔ∏è
</span></span><span style=display:flex><span> ‚úì Installing CNI üîå
</span></span><span style=display:flex><span> ‚úì Installing StorageClass üíæ
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-hive&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-hive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Not sure what to <span style=color:#204a87;font-weight:700>do</span> next? üòÖ  Check out https://kind.sigs.k8s.io/docs/user/quick-start/
</span></span></code></pre></div><p>The <code>/tmp/hive.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                       NAMES
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago   Up <span style=color:#0000cf;font-weight:700>2</span> minutes   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>3</span> hours ago     Up <span style=color:#0000cf;font-weight:700>3</span> hours     0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$  kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:41299
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:41299/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Build Hive and push the image to the local registry:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>CGO_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make docker-dev-push
</span></span></code></pre></div><p>Deploy Hive to the hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make deploy
</span></span></code></pre></div><p>Because we are not running on OpenShift we must also create a secret with
certificates for the hiveadmission webhooks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/hiveadmission-dev-cert.sh
</span></span></code></pre></div><p>If the hive cluster is using node image <code>kindest/node:v1.24.0</code> or later, you will
have to additionally run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-service-account-secrets.sh
</span></span></code></pre></div><p>because starting in Kubernetes 1.24.0, secrets are no longer automatically generated
for service accounts.</p><p>Tip: if it fails, check <code>kubectl</code> version. The <code>Client</code> and <code>Server</code> versions
should be in sync:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl version --short
</span></span><span style=display:flex><span>Client Version: v1.24.0
</span></span><span style=display:flex><span>Kustomize Version: v4.5.4
</span></span><span style=display:flex><span>Server Version: v1.24.0
</span></span></code></pre></div><p>Checking the Hive pods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get pods -n hive
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>hive-clustersync-0                  1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-controllers-79bbbc7f98-q9pxm   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-operator-69c4649b96-wmd79      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-jdl4l      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-s9pv9      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span></code></pre></div><h2 id=managed-cluster---kind>Managed Cluster - Kind</h2><p>Open a new terminal.</p><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$
</span></span></code></pre></div><p>Create the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh cluster1
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;cluster1&#34;</span> ...
</span></span><span style=display:flex><span> ‚úì Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> üñº
</span></span><span style=display:flex><span> ‚úì Preparing nodes üì¶
</span></span><span style=display:flex><span> ‚úì Writing configuration üìú
</span></span><span style=display:flex><span> ‚úì Starting control-plane üïπÔ∏è
</span></span><span style=display:flex><span> ‚úì Installing CNI üîå
</span></span><span style=display:flex><span> ‚úì Installing StorageClass üíæ
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-cluster1&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-cluster1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Have a nice day! üëã
</span></span><span style=display:flex><span> üòä
</span></span></code></pre></div><p>The <code>/tmp/cluster1.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED             STATUS             PORTS                                       NAMES
</span></span><span style=display:flex><span>267fa20f4a0f   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago       Up <span style=color:#0000cf;font-weight:700>2</span> minutes       172.17.0.1:40431-&gt;6443/tcp                  cluster1-control-plane
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr‚Ä¶&#34;</span>   About an hour ago   Up About an hour   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>5</span> hours ago         Up <span style=color:#0000cf;font-weight:700>5</span> hours         0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:40431
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:40431/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Before we install OLM, we have to edit the install scripts to use <code>cluster1</code>. Go into <code>scripts/build_local.sh</code>
and replace</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>${#</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>    <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name </span><span style=color:#4e9a06>${</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[0]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Use cluster ${CLUSTERS[0]}&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>fi</span>
</span></span></code></pre></div><p>with</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name cluster1&#34;</span>
</span></span></code></pre></div><p>Now enter the OLM directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#204a87>cd</span> ../operator-lifecycle-manager/
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$
</span></span></code></pre></div><p>Install the CRDs and OLM using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/operator-lifecycle-manager$ make run-local
</span></span></code></pre></div><p>OLM pods should be running now:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/git/operator-lifecycle-manager$ kubectl get pods -n olm
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>catalog-operator-54bbdffc6b-hf8rz   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>olm-operator-6bfbd74fb8-cjl4b       1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>operatorhubio-catalog-gdk2d         1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          48s
</span></span><span style=display:flex><span>packageserver-5d67bbc56b-6vxqb      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          46s
</span></span></code></pre></div><p>With the cluster1 installed, let&rsquo;s create a <code>ClusterDeployment</code> in Hive
pointing to it.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Attention: hiveutil wants you to have default credentials in ~/.aws/credentials
You can fake them like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ cat ~/.aws/credentials
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>aws_access_key_id</span> <span style=color:#ce5c00;font-weight:700>=</span> foo
</span></span><span style=display:flex><span><span style=color:#000>aws_secret_access_key</span> <span style=color:#ce5c00;font-weight:700>=</span> bar
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt the cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>new-installer.openshift.com kind-cluster1  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment
</span></span><span style=display:flex><span>NAME            PLATFORM   REGION      CLUSTERTYPE   INSTALLED   INFRAID   VERSION   POWERSTATE   AGE
</span></span><span style=display:flex><span>kind-cluster1   aws        us-east-1                 <span style=color:#204a87>true</span>        infra1                           48s
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment kind-cluster1 -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=managed-cluster---crc>Managed Cluster - CRC</h2><p>Export the CRC kubeconfig filename to be created:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf
</span></span></code></pre></div><p>Login to your CRC cluster with the <code>kubeadmin</code> user:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ oc login -u kubeadmin -p **** https://api.crc.testing:6443
</span></span></code></pre></div><p>The <code>/tmp/crc.conf</code> file should now contain the dockerconfig for your
CRC cluster.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>crc.openshift.com crc  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment crc -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>Tip: in case the cluster status is &ldquo;unreachable&rdquo;, that&rsquo;s because Hive runs
in a Kubernetes cluster deployed inside a container, and it is trying to access
the CRC virtual machine that is controlled by libvirt. You will have to figure
out you firewall, but this is what worked for me:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ firewall-cmd --permanent --zone<span style=color:#ce5c00;font-weight:700>=</span>trusted --change-interface<span style=color:#ce5c00;font-weight:700>=</span>docker0
</span></span><span style=display:flex><span>success
</span></span><span style=display:flex><span>~/hive$ firewall-cmd --reload
</span></span><span style=display:flex><span>success
</span></span></code></pre></div><h2 id=selectorsyncset>SelectorSyncSet</h2><p>Export the Hive kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Create a test <code>SelectorSyncSet</code>. Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>List</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hive.openshift.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SelectorSyncSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterDeploymentSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>api.openshift.com/cso-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resourceApplyMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Sync</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Apply it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl apply -f cso-test.yaml
</span></span><span style=display:flex><span>selectorsyncset.hive.openshift.io/cso-test created
</span></span></code></pre></div><p>Now edit the <code>ClusterDeployment</code> of a cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl edit clusterdeployment kind-cluster1
</span></span></code></pre></div><p>Adding the label <code>api.openshift.com/cso-test: 'true'</code> to it. Save and exit.</p><p>The <code>cso</code> namespace should be now created in the target cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span><span style=display:flex><span>$ oc get namespace cso
</span></span><span style=display:flex><span>NAME   STATUS   AGE
</span></span><span style=display:flex><span>cso    Active   81s
</span></span></code></pre></div><h2 id=cleanup>Cleanup</h2><p>To clean-up, delete the two clusters and surrounding clutter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kind delete cluster --name hive
</span></span><span style=display:flex><span>~/hive$ kind delete cluster --name cluster1
</span></span><span style=display:flex><span>~/hive$ docker rm -f kind-registry
</span></span><span style=display:flex><span>~/hive$ docker network rm kind
</span></span></code></pre></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2023 Red Hat All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.3bff53fa2e8d9a2c4d0b3eeea5987ff2f2cc9a0f4eccb730274827d5e7cd5538.js integrity="sha256-O/9T+i6NmixNCz7upZh/8vLMmg9OzLcwJ0gn1efNVTg=" crossorigin=anonymous></script></body></html>