<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.115.3"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Run Hive Locally | Layered Products SRE</title><meta name=description content="This guide describes how to deploy a Hive environment in your local machine
using kind.
For the managed clusters, this guide covers both
kind clusters …"><meta property="og:title" content="Run Hive Locally"><meta property="og:description" content="This guide describes how to deploy a Hive environment in your local machine using kind.
For the managed clusters, this guide covers both kind clusters and CRC clusters.
Preparation Setup your GOPATH. Add to your ~/.bashrc:
export GOPATH=$HOME/go export PATH=${PATH}:${GOPATH}/bin Install kind:
~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64 ~$ chmod +x ./kind ~$ mv ./kind ~/.local/bin/kind This guide was created using kind version: kind v0.14.0 go1.18.2 linux/amd64
Install the dependencies:
~$ GO111MODULE=on go get sigs."><meta property="og:type" content="article"><meta property="og:url" content="/docs/internal-documentation/tutorials/run_hive_locally/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2023-01-30T15:31:29+01:00"><meta itemprop=name content="Run Hive Locally"><meta itemprop=description content="This guide describes how to deploy a Hive environment in your local machine using kind.
For the managed clusters, this guide covers both kind clusters and CRC clusters.
Preparation Setup your GOPATH. Add to your ~/.bashrc:
export GOPATH=$HOME/go export PATH=${PATH}:${GOPATH}/bin Install kind:
~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64 ~$ chmod +x ./kind ~$ mv ./kind ~/.local/bin/kind This guide was created using kind version: kind v0.14.0 go1.18.2 linux/amd64
Install the dependencies:
~$ GO111MODULE=on go get sigs."><meta itemprop=dateModified content="2023-01-30T15:31:29+01:00"><meta itemprop=wordCount content="1266"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Run Hive Locally"><meta name=twitter:description content="This guide describes how to deploy a Hive environment in your local machine using kind.
For the managed clusters, this guide covers both kind clusters and CRC clusters.
Preparation Setup your GOPATH. Add to your ~/.bashrc:
export GOPATH=$HOME/go export PATH=${PATH}:${GOPATH}/bin Install kind:
~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64 ~$ chmod +x ./kind ~$ mv ./kind ~/.local/bin/kind This guide was created using kind version: kind v0.14.0 go1.18.2 linux/amd64
Install the dependencies:
~$ GO111MODULE=on go get sigs."><link rel=preload href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css as=style><link href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo></span><span class=font-weight-bold>Layered Products SRE</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/internal-documentation/access/><span>Getting Access</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.c6ef0e8b82694527c274ff1c08ddb0f7.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.c6ef0e8b82694527c274ff1c08ddb0f7.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsinternal-documentation-li><a href=/docs/internal-documentation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsinternal-documentation><span>Internal Documentation</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsinternal-documentationtutorials-li><a href=/docs/internal-documentation/tutorials/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsinternal-documentationtutorials><span>Tutorials</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationtutorialsadding_ado_alerts-li><a href=/docs/internal-documentation/tutorials/adding_ado_alerts/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationtutorialsadding_ado_alerts><span>Adding ADO alerts</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationtutorialsrun_hive_locally-li><a href=/docs/internal-documentation/tutorials/run_hive_locally/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationtutorialsrun_hive_locally><span class=td-sidebar-nav-active-item>Run Hive Locally</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsinternal-documentationaccess-li><a href=/docs/internal-documentation/access/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsinternal-documentationaccess><span>Getting Access</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationaccessbackplane-access-li><a href=/docs/internal-documentation/access/backplane-access/ title="Getting Backplane Access" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationaccessbackplane-access><span>Backplane Access</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationaccessocm-api-access-li><a href=/docs/internal-documentation/access/ocm-api-access/ title="Getting OCM API Access" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationaccessocm-api-access><span>OCM API Access</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationteam_ceremonies-li><a href=/docs/internal-documentation/team_ceremonies/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationteam_ceremonies><span></span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationfeature-flags-li><a href=/docs/internal-documentation/feature-flags/ title="Feature Flags in ADO" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationfeature-flags><span>Feature Flags</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationic-li><a href=/docs/internal-documentation/ic/ title="Interrupt Catcher" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationic><span>IC</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsinternal-documentationon-call-li><a href=/docs/internal-documentation/on-call/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsinternal-documentationon-call><span>On-Call</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsonboarding-li><a href=/docs/onboarding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsonboarding><span>Onboarding</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsonboardingintroduction-li><a href=/docs/onboarding/introduction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsonboardingintroduction><span>Introduction</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsonboardingroms-li><a href=/docs/onboarding/roms/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsonboardingroms><span>ROMS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsonboardingacceptance-criteria-checklist-li><a href=/docs/onboarding/acceptance-criteria-checklist/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsonboardingacceptance-criteria-checklist><span>Acceptance Criteria Checklist</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsonboardingpager-handover-li><a href=/docs/onboarding/pager-handover/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsonboardingpager-handover><span>Pager Handover</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsonboardingsoak-test-li><a href=/docs/onboarding/soak-test/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsonboardingsoak-test><span>Soak Test</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsrelease-process-li><a href=/docs/release-process/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsrelease-process><span>Release Process</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsrelease-processgating_for_prod-li><a href=/docs/release-process/gating_for_prod/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsrelease-processgating_for_prod><span>Gating for Production</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsaddons-flow-li><a href=/docs/addons-flow/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsaddons-flow><span>Addons Flow</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsaddons-flowarchitecture-li><a href=/docs/addons-flow/architecture/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsaddons-flowarchitecture><span>Addons Flow Architecture</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsaddons-flowapis-li><a href=/docs/addons-flow/apis/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsaddons-flowapis><span>APIs</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsaddons-flowmetrics-li><a href=/docs/addons-flow/metrics/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsaddons-flowmetrics><span>Metrics</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscreating-addons-li><a href=/docs/creating-addons/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscreating-addons><span>Creating Addons</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscreating-addonsmonitoring-li><a href=/docs/creating-addons/monitoring/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscreating-addonsmonitoring><span>Monitoring Addons</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonsmonitoringslo_dashboards-li><a href=/docs/creating-addons/monitoring/slo_dashboards/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonsmonitoringslo_dashboards><span>SLO Dashboards</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonsmonitoringdeadmanssnitch_integration-li><a href=/docs/creating-addons/monitoring/deadmanssnitch_integration/ title="Dead Man's Snitch Operator Integration" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonsmonitoringdeadmanssnitch_integration><span>Dead Man's Snitch</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonsmonitoringpagerduty_integration-li><a href=/docs/creating-addons/monitoring/pagerduty_integration/ title="PagerDuty Integration" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonsmonitoringpagerduty_integration><span>PagerDuty</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonsmonitoringocm_sendgrid_service_integration-li><a href=/docs/creating-addons/monitoring/ocm_sendgrid_service_integration/ title="OCM SendGrid Service Integration" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonsmonitoringocm_sendgrid_service_integration><span>SendGrid</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscreating-addonstesting-li><a href=/docs/creating-addons/testing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscreating-addonstesting><span>Testing Addons</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonstestinginstall-specific-version-of-addon-li><a href=/docs/creating-addons/testing/install-specific-version-of-addon/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonstestinginstall-specific-version-of-addon><span>Installing a specific version of an Addon in a staging environment</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonstestingwithout-ocm-li><a href=/docs/creating-addons/testing/without-ocm/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonstestingwithout-ocm><span>Testing With OCP (Without OCM)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonstestingosde2e-li><a href=/docs/creating-addons/testing/osde2e/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonstestingosde2e><span>Testing With OSD-E2E</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscreating-addonstop-level-operator-li><a href=/docs/creating-addons/top-level-operator/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscreating-addonstop-level-operator><span>Top Level Operator</span></a><ul class="ul-3 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonstop-level-operatorcustomer-notifications-li><a href=/docs/creating-addons/top-level-operator/customer-notifications/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonstop-level-operatorcustomer-notifications><span>Customer Notifications</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonstop-level-operatordependencies-li><a href=/docs/creating-addons/top-level-operator/dependencies/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonstop-level-operatordependencies><span>Dependencies</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonstop-level-operatorenvironments-li><a href=/docs/creating-addons/top-level-operator/environments/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonstop-level-operatorenvironments><span>Environments</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonstop-level-operatoraddon-package-li><a href=/docs/creating-addons/top-level-operator/addon-package/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonstop-level-operatoraddon-package><span>Plug and Play Addon</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonsmanaged-tenants-repository-li><a href=/docs/creating-addons/managed-tenants-repository/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonsmanaged-tenants-repository><span>managed-tenants Repository</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscreating-addonssku-li><a href=/docs/creating-addons/sku/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscreating-addonssku><span>SKU</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/mt-sre/mt-sre.github.io/edit/main/content/en/docs/internal-documentation/tutorials/run_hive_locally.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/mt-sre/mt-sre.github.io/new/main/content/en/docs/internal-documentation/tutorials/run_hive_locally.md?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" target=_blank><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/mt-sre/mt-sre.github.io/issues/new?title=Run%20Hive%20Locally" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a id=print href=/docs/internal-documentation/tutorials/_print/><i class="fa fa-print fa-fw"></i> Print entire section</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#preparation>Preparation</a></li><li><a href=#hive>Hive</a></li><li><a href=#managed-cluster---kind>Managed Cluster - Kind</a></li><li><a href=#managed-cluster---crc>Managed Cluster - CRC</a></li><li><a href=#selectorsyncset>SelectorSyncSet</a></li><li><a href=#cleanup>Cleanup</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/internal-documentation/>Internal Documentation</a></li><li class=breadcrumb-item><a href=/docs/internal-documentation/tutorials/>Tutorials</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/internal-documentation/tutorials/run_hive_locally/>Run Hive Locally</a></li></ol></nav><div class=td-content><h1>Run Hive Locally</h1><header class=article-meta></header><p>This guide describes how to deploy a Hive environment in your local machine
using <a href=https://kind.sigs.k8s.io/>kind</a>.</p><p>For the managed clusters, this guide covers both
<a href=https://kind.sigs.k8s.io/>kind</a> clusters and
<a href=https://developers.redhat.com/products/codeready-containers/overview>CRC</a>
clusters.</p><h2 id=preparation>Preparation</h2><p>Setup your <code>GOPATH</code>. Add to your <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GOPATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$HOME</span>/go
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>PATH</span><span style=color:#4e9a06>}</span>:<span style=color:#4e9a06>${</span><span style=color:#000>GOPATH</span><span style=color:#4e9a06>}</span>/bin
</span></span></code></pre></div><p>Install <code>kind</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64
</span></span><span style=display:flex><span>~$ chmod +x ./kind
</span></span><span style=display:flex><span>~$ mv ./kind ~/.local/bin/kind
</span></span></code></pre></div><blockquote><p>This guide was created using kind version: <code>kind v0.14.0 go1.18.2 linux/amd64</code></p></blockquote><p>Install the dependencies:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#000>GO111MODULE</span><span style=color:#ce5c00;font-weight:700>=</span>on go get sigs.k8s.io/kustomize/kustomize/v3
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssl
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssljson
</span></span><span style=display:flex><span>~$ go get -u github.com/openshift/imagebuilder/cmd/imagebuilder
</span></span></code></pre></div><p>Clone OLM and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:operator-framework/operator-lifecycle-manager.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> operator-lifecycle-manager
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ git checkout -b v0.21.2 v0.21.2
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ <span style=color:#204a87>cd</span> ..
</span></span></code></pre></div><p>Clone Hive and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:openshift/hive.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$ git checkout 56adaaacf5f8075e3ad0896dac35243a863ec07b
</span></span></code></pre></div><p>Edit the <code>hack/create-kind-cluster.sh</code>, adding the apiServerAddress pointing
to your local <code>docker0</code> bridge IP. This is needed so the Hive cluster, which
runs inside a docker container, can reach the managed cluster, running inside
another docker container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind.x-k8s.io/v1alpha4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>networking</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiServerAddress</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;172.17.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># docker0 bridge IP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>containerdConfigPatches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000;font-weight:700>|-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors.&#34;localhost:${reg_port}&#34;]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      endpoint = [&#34;http://${reg_name}:${reg_port}&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>    
</span></span></span></code></pre></div><h2 id=hive>Hive</h2><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Create the Hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh hive
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span> ✓ Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> 🖼
</span></span><span style=display:flex><span> ✓ Preparing nodes 📦
</span></span><span style=display:flex><span> ✓ Writing configuration 📜
</span></span><span style=display:flex><span> ✓ Starting control-plane 🕹️
</span></span><span style=display:flex><span> ✓ Installing CNI 🔌
</span></span><span style=display:flex><span> ✓ Installing StorageClass 💾
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-hive&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-hive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Not sure what to <span style=color:#204a87;font-weight:700>do</span> next? 😅  Check out https://kind.sigs.k8s.io/docs/user/quick-start/
</span></span></code></pre></div><p>The <code>/tmp/hive.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                       NAMES
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago   Up <span style=color:#0000cf;font-weight:700>2</span> minutes   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc…&#34;</span>   <span style=color:#0000cf;font-weight:700>3</span> hours ago     Up <span style=color:#0000cf;font-weight:700>3</span> hours     0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$  kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:41299
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:41299/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Build Hive and push the image to the local registry:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>CGO_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make docker-dev-push
</span></span></code></pre></div><p>Deploy Hive to the hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make deploy
</span></span></code></pre></div><p>Because we are not running on OpenShift we must also create a secret with
certificates for the hiveadmission webhooks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/hiveadmission-dev-cert.sh
</span></span></code></pre></div><p>If the hive cluster is using node image <code>kindest/node:v1.24.0</code> or later, you will
have to additionally run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-service-account-secrets.sh
</span></span></code></pre></div><p>because starting in Kubernetes 1.24.0, secrets are no longer automatically generated
for service accounts.</p><p>Tip: if it fails, check <code>kubectl</code> version. The <code>Client</code> and <code>Server</code> versions
should be in sync:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl version --short
</span></span><span style=display:flex><span>Client Version: v1.24.0
</span></span><span style=display:flex><span>Kustomize Version: v4.5.4
</span></span><span style=display:flex><span>Server Version: v1.24.0
</span></span></code></pre></div><p>Checking the Hive pods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get pods -n hive
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>hive-clustersync-0                  1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-controllers-79bbbc7f98-q9pxm   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-operator-69c4649b96-wmd79      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-jdl4l      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-s9pv9      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span></code></pre></div><h2 id=managed-cluster---kind>Managed Cluster - Kind</h2><p>Open a new terminal.</p><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$
</span></span></code></pre></div><p>Create the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh cluster1
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;cluster1&#34;</span> ...
</span></span><span style=display:flex><span> ✓ Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> 🖼
</span></span><span style=display:flex><span> ✓ Preparing nodes 📦
</span></span><span style=display:flex><span> ✓ Writing configuration 📜
</span></span><span style=display:flex><span> ✓ Starting control-plane 🕹️
</span></span><span style=display:flex><span> ✓ Installing CNI 🔌
</span></span><span style=display:flex><span> ✓ Installing StorageClass 💾
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-cluster1&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-cluster1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Have a nice day! 👋
</span></span><span style=display:flex><span> 😊
</span></span></code></pre></div><p>The <code>/tmp/cluster1.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED             STATUS             PORTS                                       NAMES
</span></span><span style=display:flex><span>267fa20f4a0f   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago       Up <span style=color:#0000cf;font-weight:700>2</span> minutes       172.17.0.1:40431-&gt;6443/tcp                  cluster1-control-plane
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   About an hour ago   Up About an hour   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc…&#34;</span>   <span style=color:#0000cf;font-weight:700>5</span> hours ago         Up <span style=color:#0000cf;font-weight:700>5</span> hours         0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:40431
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:40431/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Before we install OLM, we have to edit the install scripts to use <code>cluster1</code>. Go into <code>scripts/build_local.sh</code>
and replace</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>${#</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>    <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name </span><span style=color:#4e9a06>${</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[0]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Use cluster ${CLUSTERS[0]}&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>fi</span>
</span></span></code></pre></div><p>with</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name cluster1&#34;</span>
</span></span></code></pre></div><p>Now enter the OLM directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#204a87>cd</span> ../operator-lifecycle-manager/
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$
</span></span></code></pre></div><p>Install the CRDs and OLM using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/operator-lifecycle-manager$ make run-local
</span></span></code></pre></div><p>OLM pods should be running now:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/git/operator-lifecycle-manager$ kubectl get pods -n olm
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>catalog-operator-54bbdffc6b-hf8rz   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>olm-operator-6bfbd74fb8-cjl4b       1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>operatorhubio-catalog-gdk2d         1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          48s
</span></span><span style=display:flex><span>packageserver-5d67bbc56b-6vxqb      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          46s
</span></span></code></pre></div><p>With the cluster1 installed, let&rsquo;s create a <code>ClusterDeployment</code> in Hive
pointing to it.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Attention: hiveutil wants you to have default credentials in ~/.aws/credentials
You can fake them like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ cat ~/.aws/credentials
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>aws_access_key_id</span> <span style=color:#ce5c00;font-weight:700>=</span> foo
</span></span><span style=display:flex><span><span style=color:#000>aws_secret_access_key</span> <span style=color:#ce5c00;font-weight:700>=</span> bar
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt the cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>new-installer.openshift.com kind-cluster1  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment
</span></span><span style=display:flex><span>NAME            PLATFORM   REGION      CLUSTERTYPE   INSTALLED   INFRAID   VERSION   POWERSTATE   AGE
</span></span><span style=display:flex><span>kind-cluster1   aws        us-east-1                 <span style=color:#204a87>true</span>        infra1                           48s
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment kind-cluster1 -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=managed-cluster---crc>Managed Cluster - CRC</h2><p>Export the CRC kubeconfig filename to be created:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf
</span></span></code></pre></div><p>Login to your CRC cluster with the <code>kubeadmin</code> user:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ oc login -u kubeadmin -p **** https://api.crc.testing:6443
</span></span></code></pre></div><p>The <code>/tmp/crc.conf</code> file should now contain the dockerconfig for your
CRC cluster.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>crc.openshift.com crc  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment crc -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>Tip: in case the cluster status is &ldquo;unreachable&rdquo;, that&rsquo;s because Hive runs
in a Kubernetes cluster deployed inside a container, and it is trying to access
the CRC virtual machine that is controlled by libvirt. You will have to figure
out you firewall, but this is what worked for me:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ firewall-cmd --permanent --zone<span style=color:#ce5c00;font-weight:700>=</span>trusted --change-interface<span style=color:#ce5c00;font-weight:700>=</span>docker0
</span></span><span style=display:flex><span>success
</span></span><span style=display:flex><span>~/hive$ firewall-cmd --reload
</span></span><span style=display:flex><span>success
</span></span></code></pre></div><h2 id=selectorsyncset>SelectorSyncSet</h2><p>Export the Hive kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Create a test <code>SelectorSyncSet</code>. Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>List</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hive.openshift.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SelectorSyncSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterDeploymentSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>api.openshift.com/cso-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resourceApplyMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Sync</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Apply it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl apply -f cso-test.yaml
</span></span><span style=display:flex><span>selectorsyncset.hive.openshift.io/cso-test created
</span></span></code></pre></div><p>Now edit the <code>ClusterDeployment</code> of a cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl edit clusterdeployment kind-cluster1
</span></span></code></pre></div><p>Adding the label <code>api.openshift.com/cso-test: 'true'</code> to it. Save and exit.</p><p>The <code>cso</code> namespace should be now created in the target cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span><span style=display:flex><span>$ oc get namespace cso
</span></span><span style=display:flex><span>NAME   STATUS   AGE
</span></span><span style=display:flex><span>cso    Active   81s
</span></span></code></pre></div><h2 id=cleanup>Cleanup</h2><p>To clean-up, delete the two clusters and surrounding clutter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kind delete cluster --name hive
</span></span><span style=display:flex><span>~/hive$ kind delete cluster --name cluster1
</span></span><span style=display:flex><span>~/hive$ docker rm -f kind-registry
</span></span><span style=display:flex><span>~/hive$ docker network rm kind
</span></span></code></pre></div><div class="text-muted mt-5 pt-3 border-top">Last modified January 30, 2023: <a href=https://github.com/mt-sre/mt-sre.github.io/commit/3873365eb8dc0f8dcb85342041a8f26f56c02c30>wip (3873365)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.3bff53fa2e8d9a2c4d0b3eeea5987ff2f2cc9a0f4eccb730274827d5e7cd5538.js integrity="sha256-O/9T+i6NmixNCz7upZh/8vLMmg9OzLcwJ0gn1efNVTg=" crossorigin=anonymous></script></body></html>