<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=/docs/internal-documentation/><link rel=alternate type=application/rss+xml href=/docs/internal-documentation/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Internal Documentation | Layered Products SRE</title><meta name=description content="Internal Documentation for the SRE teams.
"><meta property="og:title" content="Internal Documentation"><meta property="og:description" content="Internal Documentation for the SRE teams.
"><meta property="og:type" content="website"><meta property="og:url" content="/docs/internal-documentation/"><meta property="og:site_name" content="Layered Products SRE"><meta itemprop=name content="Internal Documentation"><meta itemprop=description content="Internal Documentation for the SRE teams.
"><meta name=twitter:card content="summary"><meta name=twitter:title content="Internal Documentation"><meta name=twitter:description content="Internal Documentation for the SRE teams.
"><link rel=preload href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css as=style><link href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo></span><span class=font-weight-bold>Layered Products SRE</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/internal-documentation/access/><span>Getting Access</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.ba271c73d7d7d85614fd3b34aca75ea9.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/internal-documentation/>Return to the regular view of this page</a>.</p></div><h1 class=title>Internal Documentation</h1><div class=lead>Internal Documentation for the SRE teams.</div><ul><li>1: <a href=#pg-08bce11ba2b3e79b049fb33ada611058>Tutorials</a></li><ul><li>1.1: <a href=#pg-5da6968793d1f802cd0b0096fd75b798>Run Hive Locally</a></li></ul><li>2: <a href=#pg-27eca321578926411c44d80a72193e2c>Getting Access</a></li><ul><li>2.1: <a href=#pg-4ce071f48fb171d6097d786b6dab0436>Getting Backplane Access</a></li><li>2.2: <a href=#pg-7103766431a69629303d217d872a2945>Getting OCM API Access</a></li></ul><li>3: <a href=#pg-8fde7ed4c7d2a359ffa241db90c80bfa></a></li><li>4: <a href=#pg-98267173d0a33a26ee9325bebb5e9a56>Interrupt Catcher</a></li><li>5: <a href=#pg-43cb85f49066c3b7f999f0926752db09>On-Call</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-08bce11ba2b3e79b049fb33ada611058>1 - Tutorials</h1></div><div class=td-content><h1 id=pg-5da6968793d1f802cd0b0096fd75b798>1.1 - Run Hive Locally</h1><p>This guide describes how to deploy a Hive environment in your local machine
using <a href=https://kind.sigs.k8s.io/>kind</a>.</p><p>For the managed clusters, this guide covers both
<a href=https://kind.sigs.k8s.io/>kind</a> clusters and
<a href=https://developers.redhat.com/products/codeready-containers/overview>CRC</a>
clusters.</p><h2 id=preparation>Preparation</h2><p>Setup your <code>GOPATH</code>. Add to your <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GOPATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$HOME</span>/go
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>PATH</span><span style=color:#4e9a06>}</span>:<span style=color:#4e9a06>${</span><span style=color:#000>GOPATH</span><span style=color:#4e9a06>}</span>/bin
</span></span></code></pre></div><p>Install <code>kind</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64
</span></span><span style=display:flex><span>~$ chmod +x ./kind
</span></span><span style=display:flex><span>~$ mv ./kind ~/.local/bin/kind
</span></span></code></pre></div><blockquote><p>This guide was created using kind version: <code>kind v0.14.0 go1.18.2 linux/amd64</code></p></blockquote><p>Install the dependencies:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#000>GO111MODULE</span><span style=color:#ce5c00;font-weight:700>=</span>on go get sigs.k8s.io/kustomize/kustomize/v3
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssl
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssljson
</span></span><span style=display:flex><span>~$ go get -u github.com/openshift/imagebuilder/cmd/imagebuilder
</span></span></code></pre></div><p>Clone OLM and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:operator-framework/operator-lifecycle-manager.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> operator-lifecycle-manager
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ git checkout -b v0.21.2 v0.21.2
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ <span style=color:#204a87>cd</span> ..
</span></span></code></pre></div><p>Clone Hive and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:openshift/hive.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$ git checkout 56adaaacf5f8075e3ad0896dac35243a863ec07b
</span></span></code></pre></div><p>Edit the <code>hack/create-kind-cluster.sh</code>, adding the apiServerAddress pointing
to your local <code>docker0</code> bridge IP. This is needed so the Hive cluster, which
runs inside a docker container, can reach the managed cluster, running inside
another docker container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind.x-k8s.io/v1alpha4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>networking</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiServerAddress</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;172.17.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># docker0 bridge IP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>containerdConfigPatches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000;font-weight:700>|-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors.&#34;localhost:${reg_port}&#34;]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      endpoint = [&#34;http://${reg_name}:${reg_port}&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>    
</span></span></span></code></pre></div><h2 id=hive>Hive</h2><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Create the Hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh hive
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span> ✓ Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> 🖼
</span></span><span style=display:flex><span> ✓ Preparing nodes 📦
</span></span><span style=display:flex><span> ✓ Writing configuration 📜
</span></span><span style=display:flex><span> ✓ Starting control-plane 🕹️
</span></span><span style=display:flex><span> ✓ Installing CNI 🔌
</span></span><span style=display:flex><span> ✓ Installing StorageClass 💾
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-hive&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-hive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Not sure what to <span style=color:#204a87;font-weight:700>do</span> next? 😅  Check out https://kind.sigs.k8s.io/docs/user/quick-start/
</span></span></code></pre></div><p>The <code>/tmp/hive.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                       NAMES
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago   Up <span style=color:#0000cf;font-weight:700>2</span> minutes   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc…&#34;</span>   <span style=color:#0000cf;font-weight:700>3</span> hours ago     Up <span style=color:#0000cf;font-weight:700>3</span> hours     0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$  kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:41299
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:41299/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Build Hive and push the image to the local registry:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>CGO_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make docker-dev-push
</span></span></code></pre></div><p>Deploy Hive to the hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make deploy
</span></span></code></pre></div><p>Because we are not running on OpenShift we must also create a secret with
certificates for the hiveadmission webhooks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/hiveadmission-dev-cert.sh
</span></span></code></pre></div><p>If the hive cluster is using node image <code>kindest/node:v1.24.0</code> or later, you will
have to additionally run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-service-account-secrets.sh
</span></span></code></pre></div><p>because starting in Kubernetes 1.24.0, secrets are no longer automatically generated
for service accounts.</p><p>Tip: if it fails, check <code>kubectl</code> version. The <code>Client</code> and <code>Server</code> versions
should be in sync:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl version --short
</span></span><span style=display:flex><span>Client Version: v1.24.0
</span></span><span style=display:flex><span>Kustomize Version: v4.5.4
</span></span><span style=display:flex><span>Server Version: v1.24.0
</span></span></code></pre></div><p>Checking the Hive pods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get pods -n hive
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>hive-clustersync-0                  1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-controllers-79bbbc7f98-q9pxm   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-operator-69c4649b96-wmd79      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-jdl4l      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-s9pv9      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span></code></pre></div><h2 id=managed-cluster---kind>Managed Cluster - Kind</h2><p>Open a new terminal.</p><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$
</span></span></code></pre></div><p>Create the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh cluster1
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;cluster1&#34;</span> ...
</span></span><span style=display:flex><span> ✓ Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> 🖼
</span></span><span style=display:flex><span> ✓ Preparing nodes 📦
</span></span><span style=display:flex><span> ✓ Writing configuration 📜
</span></span><span style=display:flex><span> ✓ Starting control-plane 🕹️
</span></span><span style=display:flex><span> ✓ Installing CNI 🔌
</span></span><span style=display:flex><span> ✓ Installing StorageClass 💾
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-cluster1&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-cluster1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Have a nice day! 👋
</span></span><span style=display:flex><span> 😊
</span></span></code></pre></div><p>The <code>/tmp/cluster1.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED             STATUS             PORTS                                       NAMES
</span></span><span style=display:flex><span>267fa20f4a0f   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago       Up <span style=color:#0000cf;font-weight:700>2</span> minutes       172.17.0.1:40431-&gt;6443/tcp                  cluster1-control-plane
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr…&#34;</span>   About an hour ago   Up About an hour   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc…&#34;</span>   <span style=color:#0000cf;font-weight:700>5</span> hours ago         Up <span style=color:#0000cf;font-weight:700>5</span> hours         0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:40431
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:40431/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Before we install OLM, we have to edit the install scripts to use <code>cluster1</code>. Go into <code>scripts/build_local.sh</code>
and replace</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>${#</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>    <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name </span><span style=color:#4e9a06>${</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[0]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Use cluster ${CLUSTERS[0]}&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>fi</span>
</span></span></code></pre></div><p>with</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name cluster1&#34;</span>
</span></span></code></pre></div><p>Now enter the OLM directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#204a87>cd</span> ../operator-lifecycle-manager/
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$
</span></span></code></pre></div><p>Install the CRDs and OLM using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/operator-lifecycle-manager$ make run-local
</span></span></code></pre></div><p>OLM pods should be running now:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/git/operator-lifecycle-manager$ kubectl get pods -n olm
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>catalog-operator-54bbdffc6b-hf8rz   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>olm-operator-6bfbd74fb8-cjl4b       1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>operatorhubio-catalog-gdk2d         1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          48s
</span></span><span style=display:flex><span>packageserver-5d67bbc56b-6vxqb      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          46s
</span></span></code></pre></div><p>With the cluster1 installed, let&rsquo;s create a <code>ClusterDeployment</code> in Hive
pointing to it.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Attention: hiveutil wants you to have default credentials in ~/.aws/credentials
You can fake them like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ cat ~/.aws/credentials
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>aws_access_key_id</span> <span style=color:#ce5c00;font-weight:700>=</span> foo
</span></span><span style=display:flex><span><span style=color:#000>aws_secret_access_key</span> <span style=color:#ce5c00;font-weight:700>=</span> bar
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt the cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>new-installer.openshift.com kind-cluster1  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment
</span></span><span style=display:flex><span>NAME            PLATFORM   REGION      CLUSTERTYPE   INSTALLED   INFRAID   VERSION   POWERSTATE   AGE
</span></span><span style=display:flex><span>kind-cluster1   aws        us-east-1                 <span style=color:#204a87>true</span>        infra1                           48s
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment kind-cluster1 -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=managed-cluster---crc>Managed Cluster - CRC</h2><p>Export the CRC kubeconfig filename to be created:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf
</span></span></code></pre></div><p>Login to your CRC cluster with the <code>kubeadmin</code> user:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ oc login -u kubeadmin -p **** https://api.crc.testing:6443
</span></span></code></pre></div><p>The <code>/tmp/crc.conf</code> file should now contain the dockerconfig for your
CRC cluster.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>crc.openshift.com crc  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment crc -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>Tip: in case the cluster status is &ldquo;unreachable&rdquo;, that&rsquo;s because Hive runs
in a Kubernetes cluster deployed inside a container, and it is trying to access
the CRC virtual machine that is controlled by libvirt. You will have to figure
out you firewall, but this is what worked for me:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ firewall-cmd --permanent --zone<span style=color:#ce5c00;font-weight:700>=</span>trusted --change-interface<span style=color:#ce5c00;font-weight:700>=</span>docker0
</span></span><span style=display:flex><span>success
</span></span><span style=display:flex><span>~/hive$ firewall-cmd --reload
</span></span><span style=display:flex><span>success
</span></span></code></pre></div><h2 id=selectorsyncset>SelectorSyncSet</h2><p>Export the Hive kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Create a test <code>SelectorSyncSet</code>. Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>List</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hive.openshift.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SelectorSyncSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterDeploymentSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>api.openshift.com/cso-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resourceApplyMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Sync</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Apply it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl apply -f cso-test.yaml
</span></span><span style=display:flex><span>selectorsyncset.hive.openshift.io/cso-test created
</span></span></code></pre></div><p>Now edit the <code>ClusterDeployment</code> of a cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl edit clusterdeployment kind-cluster1
</span></span></code></pre></div><p>Adding the label <code>api.openshift.com/cso-test: 'true'</code> to it. Save and exit.</p><p>The <code>cso</code> namespace should be now created in the target cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span><span style=display:flex><span>$ oc get namespace cso
</span></span><span style=display:flex><span>NAME   STATUS   AGE
</span></span><span style=display:flex><span>cso    Active   81s
</span></span></code></pre></div><h2 id=cleanup>Cleanup</h2><p>To clean-up, delete the two clusters and surrounding clutter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kind delete cluster --name hive
</span></span><span style=display:flex><span>~/hive$ kind delete cluster --name cluster1
</span></span><span style=display:flex><span>~/hive$ docker rm -f kind-registry
</span></span><span style=display:flex><span>~/hive$ docker network rm kind
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-27eca321578926411c44d80a72193e2c>2 - Getting Access</h1></div><div class=td-content><h1 id=pg-4ce071f48fb171d6097d786b6dab0436>2.1 - Getting Backplane Access</h1><h2 id=backplane>Backplane</h2><p>Backplane is the system used to provide access to the fleet of Openshift clusters. It
creates ssh tunnels and modifies your local <code>~/.kube/config</code>.</p><h3 id=getting-access>Getting access</h3><ol><li><a href=https://github.com/openshift-online/ocm-cli#installation>Install ocm CLI</a></li><li><a href=https://source.redhat.com/groups/public/openshiftplatformsre/wiki/backplane_user_documentation>Follow the instructions here</a></li><li>Make sure your user is part of the
<a href=https://rover.redhat.com/groups/group/sd-mtsre><code>sd-mtsre</code> Rover group</a>.</li><li>Wait for <code>https://gitlab.cee.redhat.com/service/authorizedkeys-builder</code>
to sync your ssh key onto the fleet of Openshift clusters</li><li><a href=https://gitlab.cee.redhat.com/service/backplane-cli#install>Install backplane CLI</a>
or use the <a href=https://gitlab.consulting.redhat.com/red-hat-arch-linux-users/backplane-cli>PKGBUILD</a>.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-7103766431a69629303d217d872a2945>2.2 - Getting OCM API Access</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-8fde7ed4c7d2a359ffa241db90c80bfa>3 -</h1><h1 id=team-ceremonies>Team Ceremonies</h1><h2 id=sprint-duration>Sprint Duration</h2><p>The Managed Tenants SRE Team lasts 3 full weeks.</p><h2 id=backlog-refinement>Backlog Refinement</h2><p>Every 3 weeks. 1h (max). Before the sprint ends; planned around half a week
before the next sprint.</p><ul><li>Scrum Team comes together to refine issues in our backlog and to ensure that
important issues are actionable for the next sprint.</li><li>Product Owner owns the backlog and can communicate their needs and wishes to the Dev Team</li><li>This includes:<ul><li>ensuring that the Definition of Ready is met for most of our issues</li><li>sorting and prioritizing them</li><li>estimating issue complexity with the team</li></ul></li></ul><h2 id=sprint-retro>Sprint Retro</h2><p>Every 3 weeks. 30-minute (max). Before the sprint ends. Right now this
happens right before the planning meeting for the next sprint:</p><ul><li>Scrum Team comes together to fine tune processes and other stuff that they deem important.</li><li>The goals of continuous Retro meetings are:<ul><li>to inspect the current way of working</li><li>and adapt it if necessary</li><li>in small steps and an iterative fashion</li><li>incorporate eventual process changes in the next sprint</li></ul></li><li><a href=https://www.notion.so/First-Retro-8cb1180cda1f4b03879065e225392b50>Guide that @jgwosdz used for our first retro</a></li><li>Our retro dashboard with retros and derived action items: <a href=https://action.parabol.co/team/3heARr2dbz>https://action.parabol.co/team/3heARr2dbz</a></li></ul><h2 id=sprint-review>Sprint Review</h2><p>Every 3 weeks. 30-minute (max) meeting, hosted on the same day that the Sprint
finishes:</p><ul><li>Scrum Team presents the results of their work to key stakeholders.</li></ul><h2 id=sprint-planning>Sprint Planning</h2><p>Every 3 weeks. 30-minute (max) hosted on the same day that the Sprint begins.
Sprint Planning addresses the following topics:</p><ul><li>Why is this Sprint valuable?</li><li>What can be Done this Sprint?</li><li>How will the chosen work get done?</li></ul><p>The Sprint Goal, the Product Backlog items selected for the Sprint, plus the
plan for delivering them are together referred to as the Sprint Backlog.</p><h2 id=scrum-meeting>Scrum Meeting</h2><p>Every week. 1-hour (max) meeting for the Scrum Team with focus on progress
towards the Sprint Goal and produces an actionable plan for the next week of
work.</p><p>Each Scrum Team member will describe:</p><ul><li>Last week&rsquo;s work.</li><li>Plans for the next week.</li><li>Blockers.</li></ul><h2 id=weekly-tenants-sync>Weekly Tenants Sync</h2><p>Every week. 1-hour (max) meeting for the Scrum Team and the Tenants to make
announcements, collect feedback and discuss requirements.</p><h2 id=definition-of-readydone>Definition Of Ready/Done</h2><p>Both definitions have been inlined into our issue template that <a href="https://issues.redhat.com/browse/MTSRE-61?jql=sprint%20%3D%2025038">live in a separate &rsquo;eversprint&rsquo;</a></p><p>This is our jira project: <a href="https://issues.redhat.com/secure/RapidBoard.jspa?rapidView=8694&projectKey=MTSRE&view=planning">https://issues.redhat.com/secure/RapidBoard.jspa?rapidView=8694&projectKey=MTSRE&view=planning</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-98267173d0a33a26ee9325bebb5e9a56>4 - Interrupt Catcher</h1><p>The Interrupt Catcher is the entry-point for any tenant to get help,
ask questions and raise issues. It&rsquo;s our interface with our Tenants.</p><p>The MT-SRE Team member with the Interrupt Catcher responsibility can
be reached out via the @mt-sre-ic Slack handle, in
the #forum-managed-tenants channel.</p><h2 id=coverage>Coverage</h2><p>Each working day has 15 hours of IC &ldquo;Follow The Sun&rdquo; coverage:</p><ul><li>APAC: From 4:30 to 9:30 UTC</li><li>EMEA: From 9:30 to 14:30 UTC</li><li>NASA: From 14:30 to 19:30 UTC</li></ul><p>Work items generated outside that time-frame will be picked up
in the next FTS shift.</p><p>PagerDuty Schedule: <a href=https://redhat.pagerduty.com/schedules#PM3YCH1>https://redhat.pagerduty.com/schedules#PM3YCH1</a></p><h2 id=response-time>Response Time</h2><table><thead><tr><th>Service Level Indicator (SLI)</th><th style=text-align:center>SLO Time</th><th style=text-align:center>MT-SRE &ldquo;Goal Time&rdquo;</th></tr></thead><tbody><tr><td>MR&rsquo;s to managed-tenants repositories</td><td style=text-align:center>24 FTSH*</td><td style=text-align:center>4 FTSH*</td></tr><tr><td>#forum-managed-tenants Slack messages, misc. support</td><td style=text-align:center>best effort</td><td style=text-align:center>4 FTSH*</td></tr></tbody></table><p>*FTSH: Follow The Sun working Hours</p><h2 id=responsibilities>Responsibilities</h2><ul><li>Review Merge Requests created by the MT-SRE Tenants on the
&ldquo;Surfaces&rdquo; repositories (listed in the next section)</li><li>Respond to the alerts in the #sd-mt-sre-alert Slack channel</li><li>Respond to incidents from PagerDuty</li><li>Respond to questions and requests from the MT-SRE tenants in
the #forum-managed-tenants Slack channel</li><li>Engage on incidents with Addons that are on-boarding to the
MT-SRE</li><li>Handover the outstanding work to the next IC</li></ul><h2 id=surfaces>Surfaces</h2><ul><li>Slack channels:<ul><li><code>#sd-mt-sre-info</code></li><li><code>#mt-cs-sre-teamchat</code></li><li><code>#mt-cs-sre-teamhandover</code></li><li><code>#forum-managed-tenants</code></li></ul></li><li>Mailing lists:<ul><li><a href=mailto:mt-cs-sre@redhat.com>mt-cs-sre@redhat.com</a></li></ul></li><li>Git Repositories:<ul><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants-bundles>https://gitlab.cee.redhat.com/service/managed-tenants-bundles</a>
(not automated)</li><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants>https://gitlab.cee.redhat.com/service/managed-tenants</a>
(tenants-related MRs, partially automated)</li><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants-manifests>https://gitlab.cee.redhat.com/service/managed-tenants-manifests</a>
(fully automated)</li><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants-sops>https://gitlab.cee.redhat.com/service/managed-tenants-sops</a>
(tenants-related MRs, partially automated)</li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-43cb85f49066c3b7f999f0926752db09>5 - On-Call</h1><p><a href=https://source.redhat.com/groups/public/openshiftplatformsre/wiki/team_sd_sre_on_call_practices>https://source.redhat.com/groups/public/openshiftplatformsre/wiki/team_sd_sre_on_call_practices</a></p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.3bff53fa2e8d9a2c4d0b3eeea5987ff2f2cc9a0f4eccb730274827d5e7cd5538.js integrity="sha256-O/9T+i6NmixNCz7upZh/8vLMmg9OzLcwJ0gn1efNVTg=" crossorigin=anonymous></script></body></html>