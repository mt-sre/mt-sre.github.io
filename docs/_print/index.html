<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.110.0"><link rel=canonical type=text/html href=/docs/><link rel=alternate type=application/rss+xml href=/docs/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Documentation | Layered Products SRE</title><meta name=description content><meta property="og:title" content="Documentation"><meta property="og:description" content="Documentation for Layered Products SRE at Red Hat"><meta property="og:type" content="website"><meta property="og:url" content="/docs/"><meta property="og:site_name" content="Layered Products SRE"><meta itemprop=name content="Documentation"><meta itemprop=description content="Documentation for Layered Products SRE at Red Hat"><meta name=twitter:card content="summary"><meta name=twitter:title content="Documentation"><meta name=twitter:description content="Documentation for Layered Products SRE at Red Hat"><link rel=preload href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css as=style><link href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo></span><span class=font-weight-bold>Layered Products SRE</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/internal-documentation/access/><span>Getting Access</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site‚Ä¶" aria-label="Search this site‚Ä¶" autocomplete=off data-offline-search-index-json-src=/offline-search-index.ba271c73d7d7d85614fd3b34aca75ea9.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Documentation</h1><ul><li>1: <a href=#pg-08bb57517af5d38553c42433eefd3c90>Internal Documentation</a></li><ul><li>1.1: <a href=#pg-08bce11ba2b3e79b049fb33ada611058>Tutorials</a></li><ul><li>1.1.1: <a href=#pg-5da6968793d1f802cd0b0096fd75b798>Run Hive Locally</a></li></ul><li>1.2: <a href=#pg-27eca321578926411c44d80a72193e2c>Getting Access</a></li><ul><li>1.2.1: <a href=#pg-4ce071f48fb171d6097d786b6dab0436>Getting Backplane Access</a></li><li>1.2.2: <a href=#pg-7103766431a69629303d217d872a2945>Getting OCM API Access</a></li></ul><li>1.3: <a href=#pg-8fde7ed4c7d2a359ffa241db90c80bfa></a></li><li>1.4: <a href=#pg-98267173d0a33a26ee9325bebb5e9a56>Interrupt Catcher</a></li><li>1.5: <a href=#pg-43cb85f49066c3b7f999f0926752db09>On-Call</a></li></ul><li>2: <a href=#pg-673495219174b1aed5cbc15e96004fe0>Onboarding</a></li><ul><li>2.1: <a href=#pg-67cb3fd93d25807ee87e9537ba8525e5>Introduction</a></li><li>2.2: <a href=#pg-05333e4e5e8e45f80619b12171cd8c51>ROMS</a></li><li>2.3: <a href=#pg-3ae34276ad7d4d6007dc78c2fafac341>Acceptance Criteria Checklist</a></li><li>2.4: <a href=#pg-4d394a07c57e182e695782763a70c4b2>Pager Handover</a></li><li>2.5: <a href=#pg-fbf02a73f4c03a33d11b8a20dc2dbafd>Soak Test</a></li></ul><li>3: <a href=#pg-2024d5370c0d0099853ac61434418db6>Release Process</a></li><ul><li>3.1: <a href=#pg-9472698f9534f40f88188ac3b952e3bc>Gating for Production</a></li></ul><li>4: <a href=#pg-4d67129bfea26e067add183b19e9db13>Addons Flow</a></li><ul><li>4.1: <a href=#pg-3c27fb28a51f6a704949207f178f4dcb>Addons Flow Architecture</a></li><li>4.2: <a href=#pg-b1cd195b3541e3385edeeb4336a5bbc5>APIs</a></li><li>4.3: <a href=#pg-e696ffe273b48e557d5a384c806c48da>Metrics</a></li></ul><li>5: <a href=#pg-46e12dee57fd2586566a257847e57975>Creating Addons</a></li><ul><li>5.1: <a href=#pg-87ba145634ea1faba32a83599fc8af8a>Monitoring Addons</a></li><ul><li>5.1.1: <a href=#pg-85e97a2a253c15db608b0997dc5e62c7>Dead Man's Snitch Operator Integration</a></li><li>5.1.2: <a href=#pg-08ad524dc84aaff13a28adb213c5d2d0>SLO Dashboards</a></li></ul><li>5.2: <a href=#pg-a24ef2ee1155c4863a1b3cebf1fa3eef>Testing Addons</a></li><ul><li>5.2.1: <a href=#pg-98595350eaad83b8d6f40022a940b660>Testing With OCP (Without OCM)</a></li><li>5.2.2: <a href=#pg-d032643a49d241811ce016a5864099bb>Testing With OSD-E2E</a></li></ul><li>5.3: <a href=#pg-a2fbdb75c90bc855ef557b55d6fcdc25>Top Level Operator</a></li><ul><li>5.3.1: <a href=#pg-25e4bd9f4a45c4e388bb613552bfe306>Customer Notifications</a></li><li>5.3.2: <a href=#pg-15a051846993924e91e0c5036e5a9d13>Dependencies</a></li><li>5.3.3: <a href=#pg-ce4044d66e5c02b22c9304d1267066c3>Environments</a></li></ul><li>5.4: <a href=#pg-e9538f544e6c384c53c67a269d2487ff>managed-tenants Repository</a></li><li>5.5: <a href=#pg-f8cb16f6aa3406735c4c9a1f009c31ae>SKU</a></li></ul></ul><div class=content></div></div><div class=td-content><h1 id=pg-08bb57517af5d38553c42433eefd3c90>1 - Internal Documentation</h1><div class=lead>Internal Documentation for the SRE teams.</div></div><div class=td-content><h1 id=pg-08bce11ba2b3e79b049fb33ada611058>1.1 - Tutorials</h1></div><div class=td-content><h1 id=pg-5da6968793d1f802cd0b0096fd75b798>1.1.1 - Run Hive Locally</h1><p>This guide describes how to deploy a Hive environment in your local machine
using <a href=https://kind.sigs.k8s.io/>kind</a>.</p><p>For the managed clusters, this guide covers both
<a href=https://kind.sigs.k8s.io/>kind</a> clusters and
<a href=https://developers.redhat.com/products/codeready-containers/overview>CRC</a>
clusters.</p><h2 id=preparation>Preparation</h2><p>Setup your <code>GOPATH</code>. Add to your <code>~/.bashrc</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>GOPATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$HOME</span>/go
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>PATH</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>${</span><span style=color:#000>PATH</span><span style=color:#4e9a06>}</span>:<span style=color:#4e9a06>${</span><span style=color:#000>GOPATH</span><span style=color:#4e9a06>}</span>/bin
</span></span></code></pre></div><p>Install <code>kind</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.10.0/kind-linux-amd64
</span></span><span style=display:flex><span>~$ chmod +x ./kind
</span></span><span style=display:flex><span>~$ mv ./kind ~/.local/bin/kind
</span></span></code></pre></div><blockquote><p>This guide was created using kind version: <code>kind v0.14.0 go1.18.2 linux/amd64</code></p></blockquote><p>Install the dependencies:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#000>GO111MODULE</span><span style=color:#ce5c00;font-weight:700>=</span>on go get sigs.k8s.io/kustomize/kustomize/v3
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssl
</span></span><span style=display:flex><span>~$ go get github.com/cloudflare/cfssl/cmd/cfssljson
</span></span><span style=display:flex><span>~$ go get -u github.com/openshift/imagebuilder/cmd/imagebuilder
</span></span></code></pre></div><p>Clone OLM and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:operator-framework/operator-lifecycle-manager.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> operator-lifecycle-manager
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ git checkout -b v0.21.2 v0.21.2
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$ <span style=color:#204a87>cd</span> ..
</span></span></code></pre></div><p>Clone Hive and checkout the version:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ git clone git@github.com:openshift/hive.git
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$ git checkout 56adaaacf5f8075e3ad0896dac35243a863ec07b
</span></span></code></pre></div><p>Edit the <code>hack/create-kind-cluster.sh</code>, adding the apiServerAddress pointing
to your local <code>docker0</code> bridge IP. This is needed so the Hive cluster, which
runs inside a docker container, can reach the managed cluster, running inside
another docker container:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Cluster</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>kind.x-k8s.io/v1alpha4</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>networking</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>apiServerAddress</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;172.17.0.1&#34;</span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#8f5902;font-style:italic># docker0 bridge IP</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>containerdConfigPatches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#000;font-weight:700>|-</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    [plugins.&#34;io.containerd.grpc.v1.cri&#34;.registry.mirrors.&#34;localhost:${reg_port}&#34;]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      endpoint = [&#34;http://${reg_name}:${reg_port}&#34;]</span><span style=color:#f8f8f8;text-decoration:underline>    
</span></span></span></code></pre></div><h2 id=hive>Hive</h2><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Create the Hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh hive
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;hive&#34;</span> ...
</span></span><span style=display:flex><span> ‚úì Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> üñº
</span></span><span style=display:flex><span> ‚úì Preparing nodes üì¶
</span></span><span style=display:flex><span> ‚úì Writing configuration üìú
</span></span><span style=display:flex><span> ‚úì Starting control-plane üïπÔ∏è
</span></span><span style=display:flex><span> ‚úì Installing CNI üîå
</span></span><span style=display:flex><span> ‚úì Installing StorageClass üíæ
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-hive&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-hive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Not sure what to <span style=color:#204a87;font-weight:700>do</span> next? üòÖ  Check out https://kind.sigs.k8s.io/docs/user/quick-start/
</span></span></code></pre></div><p>The <code>/tmp/hive.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED         STATUS         PORTS                                       NAMES
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago   Up <span style=color:#0000cf;font-weight:700>2</span> minutes   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>3</span> hours ago     Up <span style=color:#0000cf;font-weight:700>3</span> hours     0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$  kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:41299
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:41299/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Build Hive and push the image to the local registry:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>CGO_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>0</span> <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make docker-dev-push
</span></span></code></pre></div><p>Deploy Hive to the hive cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#000>IMG</span><span style=color:#ce5c00;font-weight:700>=</span>localhost:5000/hive:latest make deploy
</span></span></code></pre></div><p>Because we are not running on OpenShift we must also create a secret with
certificates for the hiveadmission webhooks:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/hiveadmission-dev-cert.sh
</span></span></code></pre></div><p>If the hive cluster is using node image <code>kindest/node:v1.24.0</code> or later, you will
have to additionally run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-service-account-secrets.sh
</span></span></code></pre></div><p>because starting in Kubernetes 1.24.0, secrets are no longer automatically generated
for service accounts.</p><p>Tip: if it fails, check <code>kubectl</code> version. The <code>Client</code> and <code>Server</code> versions
should be in sync:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl version --short
</span></span><span style=display:flex><span>Client Version: v1.24.0
</span></span><span style=display:flex><span>Kustomize Version: v4.5.4
</span></span><span style=display:flex><span>Server Version: v1.24.0
</span></span></code></pre></div><p>Checking the Hive pods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get pods -n hive
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>hive-clustersync-0                  1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-controllers-79bbbc7f98-q9pxm   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hive-operator-69c4649b96-wmd79      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-jdl4l      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span><span style=display:flex><span>hiveadmission-6697d9df99-s9pv9      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          26m
</span></span></code></pre></div><h2 id=managed-cluster---kind>Managed Cluster - Kind</h2><p>Open a new terminal.</p><p>Export the Hive kubeconfig filename (it will be created later):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span></code></pre></div><p>Enter the <code>hive</code> directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span><span style=display:flex><span>~/hive$
</span></span></code></pre></div><p>Create the managed cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ ./hack/create-kind-cluster.sh cluster1
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;cluster1&#34;</span> ...
</span></span><span style=display:flex><span> ‚úì Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.24.0<span style=color:#ce5c00;font-weight:700>)</span> üñº
</span></span><span style=display:flex><span> ‚úì Preparing nodes üì¶
</span></span><span style=display:flex><span> ‚úì Writing configuration üìú
</span></span><span style=display:flex><span> ‚úì Starting control-plane üïπÔ∏è
</span></span><span style=display:flex><span> ‚úì Installing CNI üîå
</span></span><span style=display:flex><span> ‚úì Installing StorageClass üíæ
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-cluster1&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-cluster1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Have a nice day! üëã
</span></span><span style=display:flex><span> üòä
</span></span></code></pre></div><p>The <code>/tmp/cluster1.conf</code> file is created now. Checking the installation:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ docker ps
</span></span><span style=display:flex><span>CONTAINER ID   IMAGE                  COMMAND                  CREATED             STATUS             PORTS                                       NAMES
</span></span><span style=display:flex><span>267fa20f4a0f   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>2</span> minutes ago       Up <span style=color:#0000cf;font-weight:700>2</span> minutes       172.17.0.1:40431-&gt;6443/tcp                  cluster1-control-plane
</span></span><span style=display:flex><span>901f215229a4   kindest/node:v1.24.0   <span style=color:#4e9a06>&#34;/usr/local/bin/entr‚Ä¶&#34;</span>   About an hour ago   Up About an hour   172.17.0.1:41299-&gt;6443/tcp                  hive-control-plane
</span></span><span style=display:flex><span>0d4bf61da0a3   registry:2             <span style=color:#4e9a06>&#34;/entrypoint.sh /etc‚Ä¶&#34;</span>   <span style=color:#0000cf;font-weight:700>5</span> hours ago         Up <span style=color:#0000cf;font-weight:700>5</span> hours         0.0.0.0:5000-&gt;5000/tcp, :::5000-&gt;5000/tcp   kind-registry
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl cluster-info
</span></span><span style=display:flex><span>Kubernetes control plane is running at https://172.17.0.1:40431
</span></span><span style=display:flex><span>KubeDNS is running at https://172.17.0.1:40431/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To further debug and diagnose cluster problems, use <span style=color:#4e9a06>&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></div><p>Before we install OLM, we have to edit the install scripts to use <code>cluster1</code>. Go into <code>scripts/build_local.sh</code>
and replace</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>${#</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>    <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name </span><span style=color:#4e9a06>${</span><span style=color:#000>CLUSTERS</span><span style=color:#000;font-weight:700>[0]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#39;Use cluster ${CLUSTERS[0]}&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>fi</span>
</span></span></code></pre></div><p>with</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#000>KIND_FLAGS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;--name cluster1&#34;</span>
</span></span></code></pre></div><p>Now enter the OLM directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ <span style=color:#204a87>cd</span> ../operator-lifecycle-manager/
</span></span><span style=display:flex><span>~/operator-lifecycle-manager$
</span></span></code></pre></div><p>Install the CRDs and OLM using:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/operator-lifecycle-manager$ make run-local
</span></span></code></pre></div><p>OLM pods should be running now:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/git/operator-lifecycle-manager$ kubectl get pods -n olm
</span></span><span style=display:flex><span>NAME                                READY   STATUS    RESTARTS   AGE
</span></span><span style=display:flex><span>catalog-operator-54bbdffc6b-hf8rz   1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>olm-operator-6bfbd74fb8-cjl4b       1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          87s
</span></span><span style=display:flex><span>operatorhubio-catalog-gdk2d         1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          48s
</span></span><span style=display:flex><span>packageserver-5d67bbc56b-6vxqb      1/1     Running   <span style=color:#0000cf;font-weight:700>0</span>          46s
</span></span></code></pre></div><p>With the cluster1 installed, let&rsquo;s create a <code>ClusterDeployment</code> in Hive
pointing to it.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Attention: hiveutil wants you to have default credentials in ~/.aws/credentials
You can fake them like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ cat ~/.aws/credentials
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>default<span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span><span style=color:#000>aws_access_key_id</span> <span style=color:#ce5c00;font-weight:700>=</span> foo
</span></span><span style=display:flex><span><span style=color:#000>aws_secret_access_key</span> <span style=color:#ce5c00;font-weight:700>=</span> bar
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt the cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>new-installer.openshift.com kind-cluster1  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment
</span></span><span style=display:flex><span>NAME            PLATFORM   REGION      CLUSTERTYPE   INSTALLED   INFRAID   VERSION   POWERSTATE   AGE
</span></span><span style=display:flex><span>kind-cluster1   aws        us-east-1                 <span style=color:#204a87>true</span>        infra1                           48s
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment kind-cluster1 -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:42Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-01T14:02:41Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=managed-cluster---crc>Managed Cluster - CRC</h2><p>Export the CRC kubeconfig filename to be created:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf
</span></span></code></pre></div><p>Login to your CRC cluster with the <code>kubeadmin</code> user:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ oc login -u kubeadmin -p **** https://api.crc.testing:6443
</span></span></code></pre></div><p>The <code>/tmp/crc.conf</code> file should now contain the dockerconfig for your
CRC cluster.</p><p>Export the Hive kubeconfig filename and enter the <code>hive</code> directory (or just
switch to the first terminal, the one used to deploy Hive):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span><span style=display:flex><span>~$ <span style=color:#204a87>cd</span> hive
</span></span></code></pre></div><p>Because Hive will not provision that cluster, we have can use the <code>hiveutil</code>
to adopt it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ bin/hiveutil create-cluster <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--base-domain<span style=color:#ce5c00;font-weight:700>=</span>crc.openshift.com crc  <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt --adopt-admin-kubeconfig<span style=color:#ce5c00;font-weight:700>=</span>/tmp/crc.conf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-infra-id<span style=color:#ce5c00;font-weight:700>=</span>fakeinfra <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>--adopt-cluster-id<span style=color:#ce5c00;font-weight:700>=</span>fakeid
</span></span></code></pre></div><p>Checking the <code>ClusterDeployment</code> status:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kubectl get clusterdeployment crc -o json <span style=color:#000;font-weight:700>|</span> jq .status.conditions
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T14:21:02Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;cluster is reachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;ClusterReachable&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;Unreachable&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastProbeTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;lastTransitionTime&#34;</span>: <span style=color:#4e9a06>&#34;2021-02-02T01:45:19Z&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;message&#34;</span>: <span style=color:#4e9a06>&#34;SyncSet apply is successful&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;reason&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetApplySuccess&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;status&#34;</span>: <span style=color:#4e9a06>&#34;False&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;type&#34;</span>: <span style=color:#4e9a06>&#34;SyncSetFailed&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>Tip: in case the cluster status is &ldquo;unreachable&rdquo;, that&rsquo;s because Hive runs
in a Kubernetes cluster deployed inside a container, and it is trying to access
the CRC virtual machine that is controlled by libvirt. You will have to figure
out you firewall, but this is what worked for me:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ firewall-cmd --permanent --zone<span style=color:#ce5c00;font-weight:700>=</span>trusted --change-interface<span style=color:#ce5c00;font-weight:700>=</span>docker0
</span></span><span style=display:flex><span>success
</span></span><span style=display:flex><span>~/hive$ firewall-cmd --reload
</span></span><span style=display:flex><span>success
</span></span></code></pre></div><h2 id=selectorsyncset>SelectorSyncSet</h2><p>Export the Hive kubeconfig:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/hive.conf
</span></span></code></pre></div><p>Create a test <code>SelectorSyncSet</code>. Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>List</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hive.openshift.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SelectorSyncSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso-test</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>clusterDeploymentSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>api.openshift.com/cso-test</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resourceApplyMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Sync</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>cso</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Apply it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl apply -f cso-test.yaml
</span></span><span style=display:flex><span>selectorsyncset.hive.openshift.io/cso-test created
</span></span></code></pre></div><p>Now edit the <code>ClusterDeployment</code> of a cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~$ kubectl edit clusterdeployment kind-cluster1
</span></span></code></pre></div><p>Adding the label <code>api.openshift.com/cso-test: 'true'</code> to it. Save and exit.</p><p>The <code>cso</code> namespace should be now created in the target cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ <span style=color:#204a87>export</span> <span style=color:#000>KUBECONFIG</span><span style=color:#ce5c00;font-weight:700>=</span>/tmp/cluster1.conf
</span></span><span style=display:flex><span>$ oc get namespace cso
</span></span><span style=display:flex><span>NAME   STATUS   AGE
</span></span><span style=display:flex><span>cso    Active   81s
</span></span></code></pre></div><h2 id=cleanup>Cleanup</h2><p>To clean-up, delete the two clusters and surrounding clutter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~/hive$ kind delete cluster --name hive
</span></span><span style=display:flex><span>~/hive$ kind delete cluster --name cluster1
</span></span><span style=display:flex><span>~/hive$ docker rm -f kind-registry
</span></span><span style=display:flex><span>~/hive$ docker network rm kind
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-27eca321578926411c44d80a72193e2c>1.2 - Getting Access</h1></div><div class=td-content><h1 id=pg-4ce071f48fb171d6097d786b6dab0436>1.2.1 - Getting Backplane Access</h1><h2 id=backplane>Backplane</h2><p>Backplane is the system used to provide access to the fleet of Openshift clusters. It
creates ssh tunnels and modifies your local <code>~/.kube/config</code>.</p><h3 id=getting-access>Getting access</h3><ol><li><a href=https://github.com/openshift-online/ocm-cli#installation>Install ocm CLI</a></li><li><a href=https://source.redhat.com/groups/public/openshiftplatformsre/wiki/backplane_user_documentation>Follow the instructions here</a></li><li>Make sure your user is part of the
<a href=https://rover.redhat.com/groups/group/sd-mtsre><code>sd-mtsre</code> Rover group</a>.</li><li>Wait for <code>https://gitlab.cee.redhat.com/service/authorizedkeys-builder</code>
to sync your ssh key onto the fleet of Openshift clusters</li><li><a href=https://gitlab.cee.redhat.com/service/backplane-cli#install>Install backplane CLI</a>
or use the <a href=https://gitlab.consulting.redhat.com/red-hat-arch-linux-users/backplane-cli>PKGBUILD</a>.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-7103766431a69629303d217d872a2945>1.2.2 - Getting OCM API Access</h1></div><div class=td-content style=page-break-before:always><h1 id=pg-8fde7ed4c7d2a359ffa241db90c80bfa>1.3 -</h1><h1 id=team-ceremonies>Team Ceremonies</h1><h2 id=sprint-duration>Sprint Duration</h2><p>The Managed Tenants SRE Team lasts 3 full weeks.</p><h2 id=backlog-refinement>Backlog Refinement</h2><p>Every 3 weeks. 1h (max). Before the sprint ends; planned around half a week
before the next sprint.</p><ul><li>Scrum Team comes together to refine issues in our backlog and to ensure that
important issues are actionable for the next sprint.</li><li>Product Owner owns the backlog and can communicate their needs and wishes to the Dev Team</li><li>This includes:<ul><li>ensuring that the Definition of Ready is met for most of our issues</li><li>sorting and prioritizing them</li><li>estimating issue complexity with the team</li></ul></li></ul><h2 id=sprint-retro>Sprint Retro</h2><p>Every 3 weeks. 30-minute (max). Before the sprint ends. Right now this
happens right before the planning meeting for the next sprint:</p><ul><li>Scrum Team comes together to fine tune processes and other stuff that they deem important.</li><li>The goals of continuous Retro meetings are:<ul><li>to inspect the current way of working</li><li>and adapt it if necessary</li><li>in small steps and an iterative fashion</li><li>incorporate eventual process changes in the next sprint</li></ul></li><li><a href=https://www.notion.so/First-Retro-8cb1180cda1f4b03879065e225392b50>Guide that @jgwosdz used for our first retro</a></li><li>Our retro dashboard with retros and derived action items: <a href=https://action.parabol.co/team/3heARr2dbz>https://action.parabol.co/team/3heARr2dbz</a></li></ul><h2 id=sprint-review>Sprint Review</h2><p>Every 3 weeks. 30-minute (max) meeting, hosted on the same day that the Sprint
finishes:</p><ul><li>Scrum Team presents the results of their work to key stakeholders.</li></ul><h2 id=sprint-planning>Sprint Planning</h2><p>Every 3 weeks. 30-minute (max) hosted on the same day that the Sprint begins.
Sprint Planning addresses the following topics:</p><ul><li>Why is this Sprint valuable?</li><li>What can be Done this Sprint?</li><li>How will the chosen work get done?</li></ul><p>The Sprint Goal, the Product Backlog items selected for the Sprint, plus the
plan for delivering them are together referred to as the Sprint Backlog.</p><h2 id=scrum-meeting>Scrum Meeting</h2><p>Every week. 1-hour (max) meeting for the Scrum Team with focus on progress
towards the Sprint Goal and produces an actionable plan for the next week of
work.</p><p>Each Scrum Team member will describe:</p><ul><li>Last week&rsquo;s work.</li><li>Plans for the next week.</li><li>Blockers.</li></ul><h2 id=weekly-tenants-sync>Weekly Tenants Sync</h2><p>Every week. 1-hour (max) meeting for the Scrum Team and the Tenants to make
announcements, collect feedback and discuss requirements.</p><h2 id=definition-of-readydone>Definition Of Ready/Done</h2><p>Both definitions have been inlined into our issue template that <a href="https://issues.redhat.com/browse/MTSRE-61?jql=sprint%20%3D%2025038">live in a separate &rsquo;eversprint&rsquo;</a></p><p>This is our jira project: <a href="https://issues.redhat.com/secure/RapidBoard.jspa?rapidView=8694&projectKey=MTSRE&view=planning">https://issues.redhat.com/secure/RapidBoard.jspa?rapidView=8694&projectKey=MTSRE&view=planning</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-98267173d0a33a26ee9325bebb5e9a56>1.4 - Interrupt Catcher</h1><p>The Interrupt Catcher is the entry-point for any tenant to get help,
ask questions and raise issues. It&rsquo;s our interface with our Tenants.</p><p>The MT-SRE Team member with the Interrupt Catcher responsibility can
be reached out via the @mt-sre-ic Slack handle, in
the #forum-managed-tenants channel.</p><h2 id=coverage>Coverage</h2><p>Each working day has 15 hours of IC &ldquo;Follow The Sun&rdquo; coverage:</p><ul><li>APAC: From 4:30 to 9:30 UTC</li><li>EMEA: From 9:30 to 14:30 UTC</li><li>NASA: From 14:30 to 19:30 UTC</li></ul><p>Work items generated outside that time-frame will be picked up
in the next FTS shift.</p><p>PagerDuty Schedule: <a href=https://redhat.pagerduty.com/schedules#PM3YCH1>https://redhat.pagerduty.com/schedules#PM3YCH1</a></p><h2 id=response-time>Response Time</h2><table><thead><tr><th>Service Level Indicator (SLI)</th><th style=text-align:center>SLO Time</th><th style=text-align:center>MT-SRE &ldquo;Goal Time&rdquo;</th></tr></thead><tbody><tr><td>MR&rsquo;s to managed-tenants repositories</td><td style=text-align:center>24 FTSH*</td><td style=text-align:center>4 FTSH*</td></tr><tr><td>#forum-managed-tenants Slack messages, misc. support</td><td style=text-align:center>best effort</td><td style=text-align:center>4 FTSH*</td></tr></tbody></table><p>*FTSH: Follow The Sun working Hours</p><h2 id=responsibilities>Responsibilities</h2><ul><li>Review Merge Requests created by the MT-SRE Tenants on the
&ldquo;Surfaces&rdquo; repositories (listed in the next section)</li><li>Respond to the alerts in the #sd-mt-sre-alert Slack channel</li><li>Respond to incidents from PagerDuty</li><li>Respond to questions and requests from the MT-SRE tenants in
the #forum-managed-tenants Slack channel</li><li>Engage on incidents with Addons that are on-boarding to the
MT-SRE</li><li>Handover the outstanding work to the next IC</li></ul><h2 id=surfaces>Surfaces</h2><ul><li>Slack channels:<ul><li><code>#sd-mt-sre-info</code></li><li><code>#mt-cs-sre-teamchat</code></li><li><code>#mt-cs-sre-teamhandover</code></li><li><code>#forum-managed-tenants</code></li></ul></li><li>Mailing lists:<ul><li><a href=mailto:mt-cs-sre@redhat.com>mt-cs-sre@redhat.com</a></li></ul></li><li>Git Repositories:<ul><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants-bundles>https://gitlab.cee.redhat.com/service/managed-tenants-bundles</a>
(not automated)</li><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants>https://gitlab.cee.redhat.com/service/managed-tenants</a>
(tenants-related MRs, partially automated)</li><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants-manifests>https://gitlab.cee.redhat.com/service/managed-tenants-manifests</a>
(fully automated)</li><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants-sops>https://gitlab.cee.redhat.com/service/managed-tenants-sops</a>
(tenants-related MRs, partially automated)</li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-43cb85f49066c3b7f999f0926752db09>1.5 - On-Call</h1><p><a href=https://source.redhat.com/groups/public/openshiftplatformsre/wiki/team_sd_sre_on_call_practices>https://source.redhat.com/groups/public/openshiftplatformsre/wiki/team_sd_sre_on_call_practices</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-673495219174b1aed5cbc15e96004fe0>2 - Onboarding</h1><div class=lead>Onboarding a new layered product and getting SRE support.</div></div><div class=td-content><h1 id=pg-67cb3fd93d25807ee87e9537ba8525e5>2.1 - Introduction</h1><p>The Repeatable Onboarding for Managed Services (ROMS) article on <a href=https://source.redhat.com/communities/communities_of_practice/cross_cutting_co/cloud_services_cop/wiki/draft_how_to_get_started_with_roms_repeatable_onboarding_for_managed_services>source</a>
has a great introduction to managed services.</p><p>There are multiple steps to onboard a managed service:</p><ol><li>First the <a href=roms.md>ROMS</a> process needs to be completed.</li><li>Then the <a href=acceptance-criteria-checklist.md>onboardig acceptance criteria checklist</a>
has to be completed, along with other requirements, to onboard the addon to production.</li><li>The addon must then pass a <a href=soak-test.md>soak test</a>.</li><li>The addon then has to run in production for a given amount of time to prove its
stability, and then the pager can be handed over. See the
<a href=pager-handover.md>pager handover</a> section for more information.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-05333e4e5e8e45f80619b12171cd8c51>2.2 - ROMS</h1><p>Please start at the ROMS documentation on the Source
<a href=https://source.redhat.com/communities/communities_of_practice/cross_cutting_co/cloud_services_cop/wiki/draft_how_to_get_started_with_roms_repeatable_onboarding_for_managed_services>here</a>
to get an overview of managed services and ROMS.</p><h3 id=kickoff-overview>Kickoff Overview</h3><p>The Service Owners starts
<a href="https://docs.google.com/spreadsheets/d/1qgK3_Yt3wRTyCqxVICrobDNmwMwjoSDPrQvy6vbTPYI/edit#gid=1141875805">ROMS Checklist</a>
(including SAG review). SRES Architects will evaluate the service, determine whether it&rsquo;s
suitable and viable. If accepted it will receive a prioritization rating from the SRES
Architects, and finally assigned to an SRE team by the Addon SRE Manager.</p><p><strong>IMPORTANT</strong>: As an addon provider you can self-service onto OCM stage via the addon
flow and start prototyping before completing ROMS. You are free to experiment and
kick the tires! The only restrictions in place are the available support forums to
the Addon SRE team. These are limited to
<a href=https://coreos.slack.com/archives/C01L46M0FQC>#forum-managed-tenants</a>
and to the weekly <code>SD: Layered Products Sync</code> call (You can request an invitation via #forum-managed-tenants)</p><h3 id=kickoff-steps>Kickoff Steps</h3><ul><li>Service Owner creates an Epic in the <a href=https://issues.redhat.com/projects/SDE>SDE</a> board.<ul><li>Service Owner will request sign-off from SRES Architects: <a href=https://rover.redhat.com/people/profile/pbergene>Paul Bergene</a>,
<a href=https://rover.redhat.com/people/profile/jmelis>Jaime Melis</a> and <a href=https://rover.redhat.com/people/profile/kasingh>Karanbir Singh</a>.
Note that the preferred communication channels are the JIRA or the <a href=https://app.slack.com/client/T027F3GAJ/CCNL6UJ9W/details/top>#sd-org channel</a>.</li><li>Service Owner includes reference to the <a href=https://docs.google.com/document/d/1TjGSJdyIfsZ_90ea_bWEpj8y1pOjpq6tq5xnHrn5K68/edit>SRES Onboarding Questionnaire</a>
(part of ROMS) in the epic.</li><li>The epic should also reference a Service Definition Document. Service Definition
examples: <a href=https://www.openshift.com/products/dedicated/service-definition>OSD</a>,
<a href="https://docs.google.com/document/d/1AEx6INWMAf3iyE9P_daS4XwaL5Pl2JXHp1jg-OMPhXI/edit#heading=h.vz6sfx5le5cl">OCS</a>,
<a href=https://docs.google.com/document/d/1MKLhNu6ALmuA4UdoqfbvEbLrpGSDcSRaKvMTQX28jdU/edit>RHODS</a>,
<a href=https://access.redhat.com/articles/5534341>RHOAM</a></li></ul></li><li>SRES Architects and the Addon SRE team lead will review the epic,
discuss with the Service Owners and accept or reject it.
SRES Architects will also assign a priority.</li><li>Addon SRE lead will scope out the work needed to onboard the service into Addon SRE.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-3ae34276ad7d4d6007dc78c2fafac341>2.3 - Acceptance Criteria Checklist</h1><h2 id=addon-sre-acceptance-criteria-checklist>Addon SRE Acceptance Criteria checklist</h2><p>The Service Owners, with the assistance of the Addon SRE team,
will deploy the service to production while the SLOs are being
implemented and fine-tuned. The Addon SRE onboarding team will
work through the
<a href=https://docs.google.com/document/d/1c0drua0YciULkEuYsTCAM1E_JJK-b2TgjTeFnjxh_6c/edit>Addon SRE Acceptance Criteria Checklist</a>
process.</p><h2 id=additional-requirements>Additional Requirements</h2><p>There are also requirements from other teams, which can be found <a href=../release-process/gating_for_prod.md>here</a>.</p><h2 id=next-steps>Next Steps</h2><p>If all requirements are passed successfully, the service owners will be allowed to
deploy to production. Once the service is running in production, the service can
begin its transition period. This is where an addon proves its stability for a given
amount of time and then the pager is handed over to the SRE team. Read more about
the transition period <a href=pager-handover.md>here</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-4d394a07c57e182e695782763a70c4b2>2.4 - Pager Handover</h1><h2 id=transition-overview>Transition Overview</h2><p>This stage focuses on the viability of the service. If, after an agreed amount of time of
being in production(defaults to a 4-week rolling window), the service meets its SLOs then
it will be considered viable by SRE and the pager will be transferred to the Addon SRE
team.</p><h2 id=viability-steps>Viability Steps</h2><ul><li>The service runs in production and SLO data is collected.</li><li>An Addon SRE reviews the SLOs and SOPs.</li><li>If the SLOs are met, the service will be transitioned to Addon SRE.</li><li>Any critical alerts will be routed to the Addon SRE 24x7 PagerDuty escalation policy.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fbf02a73f4c03a33d11b8a20dc2dbafd>2.5 - Soak Test</h1><p>WIP</p></div><div class=td-content style=page-break-before:always><h1 id=pg-2024d5370c0d0099853ac61434418db6>3 - Release Process</h1><div class=lead>Release Process.</div></div><div class=td-content><h1 id=pg-9472698f9534f40f88188ac3b952e3bc>3.1 - Gating for Production</h1><p><img src=/Addons-prod-view.png alt=Agreements></p><p>This process intends to allow any addon to get to PROD, but not be
sold to customers. Before an addon is enabled for customer consumption,
various teams have to validate and agree on the content, product, and service.</p><p>The focus is on three areas:</p><h3 id=service--support>Service & Support</h3><ol><li>Layered SRE (if present): payload consistency and policy for upgrades,
testing, supportability, escalation paths + IMS; complements the Managed Tenants SRE
scope, but does not replace it.</li><li>SRE-P: OSD/ ROSA 3-R‚Äôs</li><li>CEE : SBR & context + Docs + IMS</li><li>OSD e2e: for CD Signal</li><li>OSD SRE: Ensure OSD sanity</li><li>Platform & Payload</li></ol><h3 id=pm--biz>PM / Biz</h3><ol><li>OSD / ROSA</li><li>OCM</li><li>Addon / Product</li></ol><h3 id=spec--technical-patterns>Spec & technical patterns</h3><ol><li>ServiceDev A : UX & CS</li><li>ServiceDev B : SKU, Quota, rBac - AMS</li><li>Managed Tenants SRE : consistency & Policy for payload delivery, upgrades, testing</li></ol><h2 id=indicating-agreement>Indicating agreement</h2><p>Each team in the scope above needs to explicitly indicate agreement for the go-live signal.
This can be done via a +1 / LGTM signal on the Merge Request that &lsquo;Releases Content for
non-Red Hat consumption&rsquo; or via a linked JIRA where the SKU rules are requested to go live.
The go-Live signal is normally defined as either when the SKUs are enabled with AMS
delivering quota reconcile against it, or it could just be a &lsquo;Free with OSD&rsquo; / &lsquo;Free overall&rsquo;.</p><h2 id=get-to-prod-consideration>Get to Prod consideration</h2><p>Promoting an addon to prod does not automatically mean it can be consumed by
a non-Red Hat person e.g. a customer. Therefore, a
reduced set of criteria applies for getting content and the addon itself
available to Dev, QE, CEE, SRE, Docs and other associated teams.</p><p>Baseline criteria then needed for the promote-to-prod is reduced to:</p><ol><li>Managed Tenants SRE agrees on consistency and policy</li><li>Passing thorough testing via <a href=https://github.com/openshift/osde2e>OSD e2e</a> for CD Signal</li><li>SREP approve and sign off on early content landing in production</li><li>Dev team has signed off on content being consumed</li></ol><p>As a fallout of this reduced criteria the corresponding
OSD cluster that lands this addon, gets a potentially lower Service assurance
from the various SRE and CEE teams.</p><h2 id=approval-and-example-data-flow>Approval and example data flow</h2><p><img src=/Addons-Rel-flow.png alt=Flow></p><p>The yellow box indicates short-lived, non-customer facing infra.</p><p>Primary Takeaway:</p><ol><li>As a developer you can deliver content into Integration or Stage as long as you meet
the basic technical requirements. Other than the eng team and SRE baseline requirements
there are no gates applied.</li><li>To get content available in Production OCM, a wider set of considerations must be met -
including sign off from Managed Tenants SRE and OSD-e2e that the platform is not being
compromised, and no forward-looking feature work is being exposed/exploited.</li><li>To release the product to customers, ALL criteria must be met, including,
but not limited to, demonstrated viability and support cover, service
definitions and demonstrated SLIs, before you can. Titles like Beta, Alpha,
GA, Tech Preview etc. are removed from the state of service, and are not
something SRE participates in.</li><li>As a part of making your content available to customers, SRE will agree on capacity
and velocity numbers based things like cost of service, human and service toil etc.
The expectation is that there will be no more customers than the agreed capacity, and
the instance of the product will remain within the agreed velocity and service goals.</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-4d67129bfea26e067add183b19e9db13>4 - Addons Flow</h1><div class=lead>Addons Flow.</div></div><div class=td-content><h1 id=pg-3c27fb28a51f6a704949207f178f4dcb>4.1 - Addons Flow Architecture</h1><p>Add-Ons are Operators. As such, Add-Ons are installed using typical Operator
objects, like <code>Subscription</code>, <code>OperatorGroup</code> and <code>CatalogSource</code>.</p><p>To get those objects into the OpenShift clusters, we rely on
<a href=https://cloud.redhat.com/openshift/>OCM</a> and
<a href=https://github.com/openshift/hive>Hive</a>. You can read more
about Hive in this <a href=https://cloud.redhat.com/blog/openshift-hive-cluster-as-a-service>blog post</a>.</p><h2 id=deployment>Deployment</h2><p>Our input is the Add-On metadata file
(<code>managed-tenants/addons/&lt;addon_name>/metadata/&lt;stage|prod>/addon.yaml</code>)
and the corresponding bundles directories
(<code>managed-tenants-bundles/addons/&lt;addon_name>/</code>).
With that in place, we will:</p><ul><li>Build the Operator catalog container image.<ul><li>Push the catalog image to our organization repository in Quay.io.</li></ul></li><li>Generate a
<a href=https://github.com/openshift/hive/blob/master/docs/syncset.md#syncset-object-definition>SyncSet</a>
with the Operator install objects.<ul><li>Apply the SyncSet to Hive.</li></ul></li><li>Generate the OCM API payload.<ul><li>Post the payload to OCM.</li></ul></li></ul><p>The Managed Tenants CI is in charge of processing the input and deploying all
the artifacts. This image shows the data flows:</p><p><img src=/addon-syncset-installation.png alt="Data Flows"></p><p>With that in place, OCM will present an &ldquo;Add-Ons&rdquo; tab, listing all the Add-Ons
that your organization has quota for. Example:</p><p><img src=/architecture_ocm_ui.png alt="Data Flows"></p><h2 id=installation>Installation</h2><p>When you click &ldquo;Install&rdquo; in the OCM Web UI, under the hood, OCM creates a
<code>SyncSet</code> <a href=https://github.com/openshift/hive/blob/master/docs/syncset.md#syncset-object-definition>object</a>
in Hive. The <code>SyncSet</code> object references the cluster in which the addon was just
installed in the <code>clusterDeploymentRefs</code> field.</p><p><img src=/architecture_install_flow.png alt="Data Flows">
<a href="https://excalidraw.com/#room=71d4b0273d4404dbbebf,Pk5KFYj9fFvXSvObY6juCA">excalidraw</a></p><p>From there, OLM will take over, installing the Operator in the OpenShift
cluster. While OLM is installing the Operator, OCM will keep polling the
telemetry data reported by the cluster, waiting for the <code>csv_succeeded=1</code>
metric from that Operator:</p><p><img src=/architecture_telemetry_wait.png alt="Data Flows"></p><p>At some point, when the Operator is fully installed, OCM will reflect that in
the Web UI:</p><p><img src=/architecture_telemetry_done.png alt="Data Flows"></p><h2 id=addon-status-lifecycle>Addon Status Lifecycle</h2><p><img src=/addon-status-ocm.png alt="Addon Status Lifecycle"></p><h2 id=deprecated-selectorsyncset-installation>Deprecated SelectorSyncSet Installation</h2><p><img src=/architecture_data_flow.png alt="Data Flows">
When you click &ldquo;Install&rdquo; in the OCM Web UI, under the hood, OCM will apply
a label to the corresponding <code>ClusterDeployment</code> object in Hive.</p><p>That label is the same label used in the <code>SelectorSyncSet</code> as a <code>matchLabel</code>.</p><p>With the <code>ClusterDeployment</code> label now matching the <code>SelectorSyncSet</code> label,
Hive will apply all the objects in the <code>SelectorSyncSet</code> to the target cluster:</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b1cd195b3541e3385edeeb4336a5bbc5>4.2 - APIs</h1><p>You can find the Addons APIs <a href=https://api.openshift.com/#/default>here</a> under
the paths <code>/api/clusters_mgmt/v1/addons/{addon_id}</code>,
<code>/api/clusters_mgmt/v1/clusters/{cluster_id}/addon_inquiries</code> and
<code>/api/clusters_mgmt/v1/clusters/{cluster_id}/addons/{addoninstallation_id}</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e696ffe273b48e557d5a384c806c48da>4.3 - Metrics</h1><h2 id=addon-operator-metrics>Addon Operator Metrics</h2><p>Addon operator metrics can be found in <a href=https://promlens.devshift.net/>PromLens</a>
in the <code>osd-observatorum-production</code> datasource.</p><p>The metrics are configured in the <a href=https://gitlab.cee.redhat.com/service/lifecycler/>lifecycler repo</a>
and the <a href=https://github.com/openshift/managed-cluster-config>managed-cluster-config repo</a>.
See the following two merge requests for reference: <a href=https://gitlab.cee.redhat.com/service/lifecycler/-/merge_requests/6/diffs>lifecycler MR</a>
and <a href=https://github.com/openshift/managed-cluster-config/pull/1281/files>managed-cluster-config MR</a>.</p><h2 id=csv_succeeded-and-csv_abnormal-metrics><code>csv_succeeded</code> and <code>csv_abnormal</code> Metrics</h2><p><code>csv_succeeded</code> and <code>csv_abnormal</code> Metrics can be found in <a href=https://infogw-proxy.api.openshift.com/>production Thanos</a>
and <a href=https://infogw-proxy.api.stage.openshift.com/>stage Thanos</a>.</p><p>It can be useful to query for <code>csv_succeeded</code> and <code>csv_abnormal</code> Metrics
by operator name, for example <code>csv_succeeded{name=~"ocs-operator.*"}</code>, or
by cluster id, for example <code>csv_succeeded{_id="049ea229-55dd-4e30-a2f0-87ae1dd37de6"}</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-46e12dee57fd2586566a257847e57975>5 - Creating Addons</h1><div class=lead>Development resources to create and work with managed services.</div></div><div class=td-content><h1 id=pg-87ba145634ea1faba32a83599fc8af8a>5.1 - Monitoring Addons</h1><div class=lead>How to monitor addons.</div></div><div class=td-content><h1 id=pg-85e97a2a253c15db608b0997dc5e62c7>5.1.1 - Dead Man's Snitch Operator Integration</h1><h2 id=overview>Overview</h2><p><a href=https://deadmanssnitch.com/>Dead Man&rsquo;s Snitch (DMS)</a> is essentially a constantly firing
prometheus alert and an external receiver(called a snitch) that will alert should the
monitoring stack go down and stop sending alerts. The generation of &ldquo;snitch&rdquo; urls is
dynamic on cluster/add-on installed. It&rsquo;s done via the
<a href=https://github.com/openshift/deadmanssnitch-operator>DMS operator</a>,
which runs on hive and is owned by SREP.</p><h2 id=usage>Usage</h2><p>The Add-On metadata file (<code>addon.yaml</code>) allows you to provide
a <code>deadmanssnitch</code> field (see <code>deadmansnitch</code> field in
the Add-On metadata file
<a href=https://github.com/mt-sre/managed-tenants-cli/blob/main/docs/tenants/zz_metadata_schema_generated.md>schema documentation</a>
for more information).
This field allows you to provide the required Dead Man&rsquo;s Snitch integration configuration.
A <code>DeadmansSnitchIntegration</code>resource is then created and applied to Hive alongside the Add-On
<a href=https://github.com/openshift/hive/blob/master/docs/syncset.md#selectorsyncset-object-definition>SelectorSyncSet (SSS)</a>.</p><h3 id=deadmanssnitchintegration-resource>DeadmansSnitchIntegration Resource</h3><p>The default DMS configurations which will be created if you specify the bare minimum
fields under &lsquo;deadmanssnitch&rsquo; field in addon metadata:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deadmanssnitch.managed.openshift.io/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DeadmansSnitchIntegration</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-{{ADDON.metadata[&#39;id&#39;]}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deadmanssnitch-operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterDeploymentSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## can be overridden by .deadmanssnitch.clusterDeploymentSelector field in addon metadata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{{<span style=color:#000>ADDON.metadata[&#39;label&#39;]}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>In</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span>- <span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>dmsAPIKeySecretRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## fixed</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deadmanssnitch-api-key</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deadmanssnitch-operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>snitchNamePostFix</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{{<span style=color:#000>ADDON.metadata[&#39;id&#39;]}}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## can be overridden by .deadmanssnitch.snitchNamePostFix field in addon metadata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{{<span style=color:#000>ADDON.metadata[&#39;deadmanssnitch&#39;][&#39;tags&#39;]}}</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>## Required</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>targetSecretRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic>## can be overridden by .deadmanssnitch.targetSecretRef.name field in addon metadata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{{<span style=color:#000>ADDON.metadata[&#39;id&#39;]}}-deadmanssnitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#8f5902;font-style:italic>## can be overridden by .deadmanssnitch.targetSecretRef.namespace field in addon metadata</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{{<span style=color:#000>ADDON.metadata[&#39;targetNamespace&#39;]}}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=examples-of-deadmanssnitch-field-in-addonyaml>Examples of <code>deadmanssnitch</code> field in <code>addon.yaml</code></h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ocs-converged</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>deadmanssnitch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;ocs-converged-stage&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-odh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>deadmanssnitch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>snitchNamePostFix</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rhods</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;rhods-integration&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>targetSecretRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-rhods-deadmanssnitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-ods-monitoring</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-api-service-internal</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>...</span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>deadmanssnitch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>clusterDeploymentSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>matchExpressions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;api.openshift.com/addon-managed-api-service-internal&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>In</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;api.openshift.com/addon-managed-api-service-internal-delete&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>operator</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>NotIn</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>values</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>snitchNamePostFix</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>rhoam</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;rhoam-production&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>targetSecretRef</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-rhoami-deadmanssnitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-rhoami-operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=generated-secret>Generated Secret</h3><p>A secrete will be generated (by default in the same namespace as your addon) with the <code>SNITCH_URL</code>.
Your add-on will need to pick up the generated secret in cluster and inject it into your
alertmanager config. Example of in-cluster created secret:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Secret</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-myaddon-operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>hive.openshift.io/managed</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;true&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>SNITCH_URL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#8f5902;font-style:italic>#url like https://nosnch.in/123123123</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Opaque</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=alert>Alert</h3><p>Your alertmanager will need a constantly firing alert that is routed to DMS:
Example of an alert that always fires:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DeadManSnitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>1m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>rules</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span>- <span style=color:#204a87;font-weight:700>alert</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DeadManSnitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>expr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>vector(1)</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>severity</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>critical</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>This is a DeadManSnitch to ensure RHODS monitoring and alerting pipeline is online.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>summary</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Alerting DeadManSnitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=route>Route</h2><p>Example of a route that forwards the firing-alert to DMS:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>match</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>alertname</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>DeadManSnitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>receiver</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>deadman-snitch</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>repeat_interval</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>5m</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h2 id=receiver>Receiver</h2><p>Example receiver for DMS:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;deadman-snitch&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>webhook_configs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#39;&lt;snitch_url&gt;?m=just+checking+in&#39;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>send_resolved</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><div class="alert alert-primary" role=alert>Before going live with the SRES SRE team, they will need to manually point the <code>tags: ["my-addon-production"]</code>
in the Service Delivery DMS account to their pagerduty service.</div><p>Please log a JIRA with your assigned SRE team to have this completed at least one week
before going live with the SRE team.</p><h3 id=current-example>Current Example</h3><ul><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants/-/blob/09cf5112e7dc5588c14f158d6490f7f1e7051c6a/addons/managed-api-service-internal/metadata/production/deadmanssnitch.yaml.j2>RHOAM addon: DMS CR template</a></li><li><a href=https://gitlab.cee.redhat.com/service/managed-tenants/-/blob/09cf5112e7dc5588c14f158d6490f7f1e7051c6a/addons/managed-api-service-internal/metadata/production/addon.yaml#L40>RHOAM addon: extraResources</a>
field in <code>addon.yaml</code></li><li><a href=https://github.com/red-hat-data-services/odh-deployer/blob/cb48c55725fd32fdc89a5ff29517b3f4cc0d1f54/monitoring/prometheus/prometheus.yaml>RHODS addon: alertmanager configuration</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-08ad524dc84aaff13a28adb213c5d2d0>5.1.2 - SLO Dashboards</h1><p>Development teams are required to co-maintain, in conjunction with
the MT-SRE Team, SLO Dashboards for the Addons they develop. This
document explains how to bootstrap the dashboard creation and
deployment.</p><h2 id=first-dashboard>First Dashboard</h2><ul><li>Fork/clone the <a href=https://gitlab.cee.redhat.com/service/managed-tenants-slos>managed-tenants-slos repository</a>.</li><li>Create the following directory structure:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>‚îú‚îÄ‚îÄ &lt;addon-name&gt;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>‚îÇ   ‚îú‚îÄ‚îÄ dashboards</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ &lt;addon-name&gt;-slo-dashboard.configmap.yaml</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>‚îÇ   ‚îî‚îÄ‚îÄ OWNERS</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#000>.</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Example <code>OWNERS</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>approvers</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>akonarde</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#000>asegundo</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>&lt;addon-name>-slo-dashboard.configmap.yaml</code> contents (replace all occurrences of <code>&lt;addon-name></code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>ConfigMap</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>&lt;addon-name&gt;-slo-dashboard</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>grafana_dashboard</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>grafana-folder</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>/grafana-dashboard-definitions/Addons</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>data</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>mtsre-rhods-slos.json</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;annotations&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &#34;list&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;builtIn&#34;: 1,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;datasource&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;type&#34;: &#34;grafana&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;uid&#34;: &#34;-- Grafana --&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;enable&#34;: true,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;hide&#34;: true,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;iconColor&#34;: &#34;rgba(0, 211, 255, 1)&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;name&#34;: &#34;Annotations &amp; Alerts&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;target&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;limit&#34;: 100,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;matchAny&#34;: false,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;tags&#34;: [],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;type&#34;: &#34;dashboard&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;type&#34;: &#34;dashboard&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        ]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;editable&#34;: true,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;fiscalYearStartMonth&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;graphTooltip&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;links&#34;: [],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;liveNow&#34;: false,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;panels&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;datasource&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;type&#34;: &#34;prometheus&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;uid&#34;: &#34;4rNsqZfnz&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;fieldConfig&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;defaults&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;color&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;mode&#34;: &#34;thresholds&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;custom&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;align&#34;: &#34;auto&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;displayMode&#34;: &#34;auto&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;inspect&#34;: false
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;mappings&#34;: [],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;thresholds&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;mode&#34;: &#34;absolute&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;steps&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &#34;color&#34;: &#34;green&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &#34;value&#34;: null
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &#34;color&#34;: &#34;red&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &#34;value&#34;: 80
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                ]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;overrides&#34;: []
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;gridPos&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;h&#34;: 16,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;w&#34;: 3,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;x&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;y&#34;: 0
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;id&#34;: 2,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;options&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;footer&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;fields&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;reducer&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;sum&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              ],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;show&#34;: false
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;showHeader&#34;: true
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;pluginVersion&#34;: &#34;9.0.1&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;targets&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;datasource&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;type&#34;: &#34;prometheus&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;uid&#34;: &#34;4rNsqZfnz&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;editorMode&#34;: &#34;code&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;expr&#34;: &#34;group by (_id) (subscription_sync_total{name=\&#34;${addon_name}\&#34;})&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;format&#34;: &#34;table&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;range&#34;: true,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;refId&#34;: &#34;A&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          ],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;title&#34;: &#34;Clusters&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;transformations&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;id&#34;: &#34;groupBy&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;options&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                &#34;fields&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  &#34;_id&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &#34;aggregations&#34;: [],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                    &#34;operation&#34;: &#34;groupby&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                  }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>                }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          ],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          &#34;type&#34;: &#34;table&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      ],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;schemaVersion&#34;: 36,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;style&#34;: &#34;dark&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;tags&#34;: [],
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;templating&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &#34;list&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;hide&#34;: 2,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;name&#34;: &#34;addon_name&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;query&#34;: &#34;addon-&lt;addon-name&gt;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;skipUrlSync&#34;: false,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            &#34;type&#34;: &#34;constant&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          }
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        ]
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;time&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &#34;from&#34;: &#34;now-6h&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>        &#34;to&#34;: &#34;now&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      },
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;timepicker&#34;: {},
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;timezone&#34;: &#34;&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;title&#34;: &#34;&lt;addon-name&gt; - SLO Dashboard&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;version&#34;: 0,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      &#34;weekStart&#34;: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>    }</span><span style=color:#f8f8f8;text-decoration:underline>    
</span></span></span></code></pre></div><ul><li>Create a Merge Request adding the files to the managed-tenants-slos git repository.</li><li>Ping @mt-sre-ic in the #forum-managed-tenants Slack channel for review.</li></ul><h2 id=dashboard-deployment>Dashboard Deployment</h2><p>Merging of the above merge request is a prerequisite for this step.</p><p>The dashboard deployment happens through app-interface, using saas-files.</p><ul><li>For each new Addon, we need to create a new saas-file in app-interface.</li><li>Give ownership of the saas-file to your team using an app-interface role file.</li></ul><p>Example Merge Request content to app-interface:</p><p><a href=https://gitlab.cee.redhat.com/service/app-interface/-/commit/9306800aabaca18cd034dfb3933a12d29506fa08>https://gitlab.cee.redhat.com/service/app-interface/-/commit/9306800aabaca18cd034dfb3933a12d29506fa08</a></p><ul><li>Ping <code>@mt-sre-ic</code> in the <code>#forum-managed-tenants</code> Slack channel for approval.</li><li>Merge Requests to app-interface are constantly reviewed/merged by AppSRE.
After the MT-SRE approval, wait until the Merge Request is merged.</li></ul><h2 id=accessing-the-dashboards>Accessing the Dashboards</h2><p>Once the app-interface merge request is merged, you will see your ConfigMaps
being deployed in the <code>#sd-mt-sre-info</code> Slack channel. For example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>app-sre-stage-01<span style=color:#ce5c00;font-weight:700>]</span> ConfigMap odf-ms-cluster-status applied
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>app-sre-prod-01<span style=color:#ce5c00;font-weight:700>]</span> ConfigMap odf-ms-cluster-status applied
</span></span></code></pre></div><p>Once the dashboards are deployed, you can see them here:</p><ul><li>STAGE: <a href=https://grafana.stage.devshift.net/dashboards/f/aGqy3WB7k/addons>https://grafana.stage.devshift.net/dashboards/f/aGqy3WB7k/addons</a></li><li>PRODUCTION: <a href=https://grafana.app-sre.devshift.net/dashboards/f/sDiLLtgVz/addons>https://grafana.app-sre.devshift.net/dashboards/f/sDiLLtgVz/addons</a></li></ul><h2 id=development-flow>Development Flow</h2><p>After all the configuration is in place:</p><p>STAGE:</p><ul><li>Dashboards on the STAGE Grafana instance should not be used by
external audiences other than the people developing the dashboards.</li><li>Changes in the <code>managed-tenants-slos</code> repository can be merged by the
development team with &ldquo;/lgtm&rdquo; comments from those in the OWNERS file.</li><li>After merged, changes are automatically delivered to the STAGE grafana instance.</li></ul><p>PRODUCTION:</p><ul><li>The dashboards on the PRODUCTION Grafana are pinpointed to a specific git
commit from the managed-tenants-slos repository in the corresponding
saas-file in app-interface.</li><li>After patching the git commit in the saas-file, owners of the saas-file can merge the promotion
with a &ldquo;/lgtm&rdquo; comment in the app-interface Merge Request.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a24ef2ee1155c4863a1b3cebf1fa3eef>5.2 - Testing Addons</h1><div class=lead>How to test addons.</div></div><div class=td-content><h1 id=pg-98595350eaad83b8d6f40022a940b660>5.2.1 - Testing With OCP (Without OCM)</h1><h2 id=testing-without-ocm>Testing Without OCM</h2><p>During the development process, it might be useful (and cheaper) to run your
addon on an OCP cluster.</p><p>You can spin up an OCP cluster on your local machine using
<a href=https://cloud.redhat.com/openshift/install/crc/installer-provisioned>CRC</a>.</p><p>OCP and OSD differ in one important aspect: OCP gives you full access, while
OSD restricts the administrative actions. But Managed Tenants will apply
resources as unrestricted admin to OSD, just like you can do with your OCP,
so OCP is a good OSD mockup for our use case.</p><p>By doing this, you&rsquo;re skipping:</p><ul><li>OCM and SKU management</li><li>Hive</li></ul><p>First, you have to build your catalog. Let take the <code>managed-odh</code> as example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ managedtenants --environment<span style=color:#ce5c00;font-weight:700>=</span>stage --addons-dir addons --dry-run run --debug tasks/deploy/10_build_push_catalog.py:managed-odh
</span></span><span style=display:flex><span>Loading stage...
</span></span><span style=display:flex><span>Loading stage <span style=color:#000>OK</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>TASKS</span> <span style=color:#ce5c00;font-weight:700>=======================================================================</span>
</span></span><span style=display:flex><span>tasks/deploy/10_build_push_catalog.py:BuildCatalog:managed-odh:stage...
</span></span><span style=display:flex><span> -&gt; creating the temporary directory
</span></span><span style=display:flex><span> -&gt; /tmp/managed-odh-stage-1bkjtsea
</span></span><span style=display:flex><span> -&gt; generating the bundle directory
</span></span><span style=display:flex><span> -&gt; generating the bundle package.yaml
</span></span><span style=display:flex><span> -&gt; building the docker image
</span></span><span style=display:flex><span> -&gt; <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;docker&#39;</span>, <span style=color:#4e9a06>&#39;build&#39;</span>, <span style=color:#4e9a06>&#39;-f&#39;</span>, PosixPath<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;/home/apahim/git/managed-tenants/Dockerfile.catalog&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>, <span style=color:#4e9a06>&#39;-t&#39;</span>, <span style=color:#4e9a06>&#39;quay.io/osd-addons/opendatahub-operator:stage-91918fe&#39;</span>, PosixPath<span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;/tmp/managed-odh-stage-1bkjtsea&#39;</span><span style=color:#ce5c00;font-weight:700>)]</span>
</span></span><span style=display:flex><span>tasks/deploy/10_build_push_catalog.py:BuildCatalog:managed-odh:stage OK
</span></span><span style=display:flex><span>tasks/deploy/10_build_push_catalog.py:PushCatalog:managed-odh:stage...
</span></span><span style=display:flex><span> -&gt; pushing the docker image
</span></span><span style=display:flex><span> -&gt; <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;docker&#39;</span>, <span style=color:#4e9a06>&#39;--config&#39;</span>, <span style=color:#4e9a06>&#39;/home/apahim/.docker&#39;</span>, <span style=color:#4e9a06>&#39;push&#39;</span>, <span style=color:#4e9a06>&#39;quay.io/osd-addons/opendatahub-operator:stage-91918fe&#39;</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>tasks/deploy/10_build_push_catalog.py:PushCatalog:managed-odh:stage OK
</span></span></code></pre></div><p>That command has built the image
<code>quay.io/osd-addons/opendatahub-operator:stage-91918fe</code> on your local machine.</p><p>You can inspect the image with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker run --rm -it --entrypoint <span style=color:#4e9a06>&#34;bash&#34;</span>  quay.io/osd-addons/opendatahub-operator:stage-91918fe -c <span style=color:#4e9a06>&#34;ls manifests/&#34;</span>
</span></span><span style=display:flex><span>0.8.0  1.0.0-experiment  managed-odh.package.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ docker run --rm -it --entrypoint <span style=color:#4e9a06>&#34;bash&#34;</span>  quay.io/osd-addons/opendatahub-operator:stage-91918fe -c <span style=color:#4e9a06>&#34;cat manifests/managed-odh.package.yml&#34;</span>
</span></span><span style=display:flex><span>channels:
</span></span><span style=display:flex><span>- currentCSV: opendatahub-operator.1.0.0-experiment
</span></span><span style=display:flex><span>  name: beta
</span></span><span style=display:flex><span>defaultChannel: beta
</span></span><span style=display:flex><span>packageName: managed-odh
</span></span></code></pre></div><p>Next, you have to tag/push that image to some public registry repository of
yours:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ docker tag quay.io/osd-addons/opendatahub-operator:stage-91918fe quay.io/&lt;my-repository&gt;/opendatahub-operator:stage-91918fe
</span></span><span style=display:flex><span>$ docker push quay.io/&lt;my-repository&gt;/opendatahub-operator:stage-91918fe
</span></span><span style=display:flex><span>Getting image <span style=color:#204a87>source</span> signatures
</span></span><span style=display:flex><span>Copying blob 9fbc4a1ed0b0 <span style=color:#204a87;font-weight:700>done</span>
</span></span><span style=display:flex><span>Copying blob c4d8f7894b7d skipped: already exists
</span></span><span style=display:flex><span>Copying blob 61598d8d1b24 skipped: already exists
</span></span><span style=display:flex><span>Copying blob 38ada4bcd26f skipped: already exists
</span></span><span style=display:flex><span>Copying blob d5fdf1f627c8 skipped: already exists
</span></span><span style=display:flex><span>Copying blob 2bf094d88b12 skipped: already exists
</span></span><span style=display:flex><span>Copying blob 8a6c7bacb5db <span style=color:#204a87;font-weight:700>done</span>
</span></span><span style=display:flex><span>Copying config 3088e48540 <span style=color:#204a87;font-weight:700>done</span>
</span></span><span style=display:flex><span>Writing manifest to image destination
</span></span><span style=display:flex><span>Copying config 3088e48540 <span style=color:#ce5c00;font-weight:700>[</span>--------------------------------------<span style=color:#ce5c00;font-weight:700>]</span> 0.0b / 3.6KiB
</span></span><span style=display:flex><span>Writing manifest to image destination
</span></span><span style=display:flex><span>Writing manifest to image destination
</span></span><span style=display:flex><span>Storing signatures
</span></span></code></pre></div><p>Now we have to apply the OpenShift resources that will install the operator
in the OCP cluster. You can use the <code>managedtenants</code> command to generate
the stage <code>SelectorSyncSet</code> and look at it for reference:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ managedtenants --environment<span style=color:#ce5c00;font-weight:700>=</span>stage --addons-dir addons --dry-run run --debug tasks/generate/99_generate_SelectorSyncSet.py
</span></span><span style=display:flex><span>Loading stage...
</span></span><span style=display:flex><span>Loading stage <span style=color:#000>OK</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>POSTTASKS</span> <span style=color:#ce5c00;font-weight:700>===================================================================</span>
</span></span><span style=display:flex><span>tasks/generate/99_generate_SelectorSyncSet.py:GenerateSSS:stage...
</span></span><span style=display:flex><span> -&gt; Generating SSS template /home/apahim/git/managed-tenants/openshift/stage.yaml
</span></span><span style=display:flex><span>tasks/generate/99_generate_SelectorSyncSet.py:GenerateSSS:stage OK
</span></span></code></pre></div><p>Here&rsquo;s the SelectorSyncSet snippet we are interested in:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>hive.openshift.io/v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>SelectorSyncSet</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-managed-odh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>clusterDeploymentSelector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>matchLabels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>api.openshift.com/addon-managed-odh</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;true&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resourceApplyMode</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Sync</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>resources</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>openshift.io/node-selector</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#4e9a06>&#34;&#34;</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>labels</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>null</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-opendatahub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operators.coreos.com/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CatalogSource</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-managed-odh-catalog</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openshift-marketplace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Managed Open Data Hub Operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/osd-addons/opendatahub-operator:stage-${IMAGE_TAG}</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>publisher</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OSD Red Hat Addons</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>sourceType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operators.coreos.com/v1alpha2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OperatorGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-layered-product-og</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-opendatahub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operators.coreos.com/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Subscription</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-managed-odh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>namespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-opendatahub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>channel</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>beta</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-odh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>source</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-managed-odh-catalog</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>sourceNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openshift-marketplace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Our OpenShift manifest to be applied to the OCP cluster looks as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>List</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span>{}<span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline></span><span style=color:#204a87;font-weight:700>items</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>v1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Namespace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-opendatahub</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operators.coreos.com/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>CatalogSource</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-managed-odh-catalog</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>displayName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Managed Open Data Hub Operator</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>image</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>quay.io/&lt;my-repository&gt;/opendatahub-operator:stage-91918fe</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>publisher</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OSD Red Hat Addons</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sourceType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>grpc</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operators.coreos.com/v1alpha2</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>OperatorGroup</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>redhat-layered-product-og</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span>- <span style=color:#204a87;font-weight:700>apiVersion</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>operators.coreos.com/v1alpha1</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>kind</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>Subscription</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>metadata</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-managed-odh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>spec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>channel</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>beta</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>managed-odh</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>source</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>addon-managed-odh-catalog</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>sourceNamespace</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>openshift-marketplace</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Finally, apply it to the OCP cluster:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ oc apply -f manifest.yaml
</span></span><span style=display:flex><span>Namespace/redhat-opendatahub created
</span></span><span style=display:flex><span>CatalogSource/addon-managed-odh-catalog created
</span></span><span style=display:flex><span>Subscription/addon-managed-odh created
</span></span><span style=display:flex><span>OperatorGroup/redhat-layered-product-og created
</span></span></code></pre></div><p>Your operator should be installed in the cluster.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-d032643a49d241811ce016a5864099bb>5.2.2 - Testing With OSD-E2E</h1><h2 id=testing-with-osd-e2e>Testing With OSD-E2E</h2><p>All Add-Ons must have a reference to a test harness container in a publicly
available repository. The Add-On development team is responsible for creating and
maintaining the test harness image. That image is generated by the OSD e2e
process.</p><p>The test harness will be tested against OCP nightly and OSD next.</p><p>Please refer to the
<a href=https://github.com/openshift/osde2e-example-test-harness/blob/main/README.md>OSD-E2E Add-On Documentation</a>
for more details on how this test harness will be run and how it is expected to
report results.</p><h2 id=primer-into-osd-e2e-tests-and-prow-jobs>Primer into OSD E2E tests and prow jobs</h2><p>To ensure certain things such as validating that the addon can be easily and successfully
installed on a customer‚Äôs cluster, we have prow jobs setup which run e2e tests
(one test suite per addon) every 12 hours. If the e2e tests corresponding to any addon fail,
then automated alerts/notifications are sent to the addon team. Every addon&rsquo;s e2e tests
are packaged in an image called ‚ÄútestHarness‚Äù, which is built and pushed to
<a href=https://quay.io>quay.io</a>by the team maintaining the addon. Once the &ldquo;testHarness&rdquo; image is
built and pushed, the team must register their addon to testHarness image‚Äôs e2e tests by
making a PR against <a href=https://github.com/openshift/release/blob/master/ci-operator/jobs/openshift/osde2e/openshift-osde2e-main-periodics.yaml>this file</a>.</p><p>You can access the portal for prow jobs <a href=https://prow.ci.openshift.org>here</a>.
The prow jobs follow the below steps to
run the e2e tests. For every e2e test defined inside
<a href=https://github.com/openshift/release/blob/master/ci-operator/jobs/openshift/osde2e/openshift-osde2e-main-periodics.yaml>this file</a>:</p><ul><li>An OSD cluster is created and the addon, which is being tested, is installed. Openshift
API is used to perform these operations via the API definition provided at <a href=https://api.openshift.com>https://api.openshift.com</a></li><li>The e2e prow job definition, specifically for the addon from <a href=https://github.com/openshift/release/blob/master/ci-operator/jobs/openshift/osde2e/openshift-osde2e-main-periodics.yaml>this file</a>,
is parsed and hence, the parameters required to run its e2e tests will be recognized as well.</li><li>The &ldquo;testHarness&rdquo; image for the addon is parsed and executed against the parameters fetched
from the above step.</li><li>If an MT-SRE team member notices those tests failing, they should notify the respective
team to take a look at them and fix them.</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a2fbdb75c90bc855ef557b55d6fcdc25>5.3 - Top Level Operator</h1><div class=lead>Top Level Operator.</div></div><div class=td-content><h1 id=pg-25e4bd9f4a45c4e388bb613552bfe306>5.3.1 - Customer Notifications</h1><h2 id=status-page>Status Page</h2><p><a href=https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/app-sre/statuspage.md>https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/app-sre/statuspage.md</a></p><p><a href=https://service.pages.redhat.com/dev-guidelines/docs/appsre/advanced/statuspage/>https://service.pages.redhat.com/dev-guidelines/docs/appsre/advanced/statuspage/</a></p><h2 id=service-logs>Service Logs</h2><p><a href=https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/blob/main/MT-SRE/sops/mt-sre-customer-notification.md>https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/blob/main/MT-SRE/sops/mt-sre-customer-notification.md</a></p><h2 id=internal-email>Internal Email</h2><p>There are multiple ways a user or group can get notified of service events (e.g.
planned maintenance, outages). There are two fields in the addon metadata file
(see Add-On metadata file <a href=https://github.com/mt-sre/managed-tenants-cli/blob/main/docs/tenants/zz_metadata_schema_generated.md>schema documentation</a>
for more information) where email addresses can be provided:</p><ul><li><code>addonOwner</code>: <em>REQUIRED</em> Point of contact for communications from Service Delivery to
addon owners. Where possible, this should be a development team mailing list
(rather than an individual developer).</li><li><code>addonNotifications</code>: This is a list of additional email addresses of
employees who would like to receive notifications about a service.</li></ul><p>There is also a mailing list that receives notifications for all services managed
by Service Delivery. Subscribe to the sd-notifications mailing list
<a href=https://post-office.corp.redhat.com/mailman/listinfo/sd-notifications>here</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-15a051846993924e91e0c5036e5a9d13>5.3.2 - Dependencies</h1><p>This document describes the supported implementation for Addon dependencies,
as signed-off by the Managed Tenants SRE Team.</p><h2 id=dependencies-specification>Dependencies Specification</h2><ul><li>Addons must specify dependencies using the OLM dependencies feature,
documented <a href=https://docs.openshift.com/container-platform/4.7/operators/understanding/olm/olm-understanding-dependency-resolution.html>here</a></li><li>The dependencies must have the version pin-pointed. Ranges are not allowed.</li><li>The dependencies must come from a <em>Trusted Catalog</em>. See the
<a href=#trusted-catalogs>Trusted Catalogs</a> section for details.</li></ul><h2 id=trusted-catalogs>Trusted Catalogs</h2><p>The Addon and its dependencies must come from Trusted Catalogs. Trusted
Catalogs are those with content published by the Managed Services Pipelines,
implemented by CPaaS, or by the Managed Tenants SRE Team.</p><h3 id=trusted-catalogs-list>Trusted Catalogs List</h3><ul><li>Addon catalog: the catalog created by the Managed Tenants SRE Team, for the
purpose of releasing the Addon. Dependency bundles can be shipped in the same
catalog of the Addon. The Addon catalog is considered &ldquo;trusted&rdquo; for
the dependencies it carries.</li><li>Red Hat Operators catalog: the catalog content goes through the Managed
Services Pipelines, same process to build some Addons themselves, just with
a different release process. This catalog is considered &ldquo;trusted&rdquo; and can be
used for dependencies.</li></ul><h3 id=including-a-catalog-in-the-trusted-list>Including a Catalog in the Trusted List</h3><ul><li>Make sure that the catalog is available on OSD and its content is released
through the Managed Services Pipelines, implemented by CPaaS.</li><li>Create a Jira ticket in the
<a href="https://issues.redhat.com/secure/CreateIssue.jspa?pid=12326231&issuetype=3">MT-SRE Team backlog</a>,
requesting the assessment of the OSD catalog you want to consider as
&ldquo;trusted&rdquo;.</li></ul><h2 id=issues>Issues</h2><p>There&rsquo;s a feature request to the OLM Team to allow specifying the
CatalogSource used for the dependencies:</p><ul><li><a href=https://issues.redhat.com/browse/OLM-2249>OLM-2249</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ce4044d66e5c02b22c9304d1267066c3>5.3.3 - Environments</h1><h2 id=mandatory-environments>Mandatory environments</h2><p>Add-ons are normally deployed to two environments:</p><ul><li><code>ocm stage</code>: development/testing - All add-ons <strong>must</strong> deploy to this
environment before being released to production.</li><li><code>ocm production</code>: once the deployment in stage has been reviewed,
accepted, and approved it can be promoted to production via <code>/lgtm</code> by
your SRE team.</li></ul><p>We recommend the <code>ocm stage</code> and <code>ocm production</code> add-on metadata be as
similar as possible.</p><h2 id=slos>SLOs</h2><p><code>ocm stage</code> have no SLO and operates with best effort support from Add-on SRE,
SREP, and App-SRE
<code>osd stage cluster</code> have no SLO and operates with best effort support from Add-on
SRE, SREP, and App-SRE
<code>ocm production</code> environments are subject to App-SRE <a href=https://gitlab.cee.redhat.com/app-sre/contract/-/blob/master/README.md#appsre-service-level-objectives>SLOs</a>.
<code>osd production cluster</code> environments are subject OSD <a href=https://source.redhat.com/groups/public/openshiftplatformsre/wiki/faq_openshift_dedicated_service_level_objectives>SLOs</a>.</p><h2 id=additional-environments-via-duplicate-add-ons>Additional Environments (via duplicate add-ons)</h2><p>Some add-on providers have had use cases which require additional add-on envs.
While we only have <code>ocm stage</code> and <code>ocm prod</code>, managed-tenants may be leveraged
to deploy to an additional add-on (like edge or internal). Today we don&rsquo;t recommend
this practice due to the need to clone all add-on metadata which increases the
risk for incorrect metadata going to production/customer clusters.</p><p>If you need to do the above, please reach out to your assigned SRE team for
guidance first.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e9538f544e6c384c53c67a269d2487ff>5.4 - managed-tenants Repository</h1><div class=lead>managed-tenants Repository.</div><p>Addons are deployed through GitOps pipelines. Most of the configuration for Addons can
be found in the
<a href=https://gitlab.cee.redhat.com/service/managed-tenants>managed-tenants Repository</a>
. See the
<a href=https://gitlab.cee.redhat.com/service/managed-tenants/-/blob/main/docs/tenants/create_an_addon.md>create an addon</a>
documentation page for a good starting point.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f8cb16f6aa3406735c4c9a1f009c31ae>5.5 - SKU</h1><div class=lead>How to request a SKU for your addon.</div><p><strong>NOTE</strong> MT-SRE do not influence SKU creation/priorities.
You must work with SDB directly for this.</p><h2 id=requesting-a-sku>Requesting a SKU</h2><p>To request a SKU, please complete the following steps:</p><ul><li>Determine a unique quota ID for the addon. This should be
lowercase with dashes and of the format <code>addon-&lt;addon-name></code>. For example:
<code>addon-prow-operator</code></li><li>Create a JIRA Request at <a href=https://issues.redhat.com/projects/SDB/>Service Dev Team B</a>
with the subject <code>Request for new Add-On SKU in OCM</code> and the following information:<ul><li>Add-On name.</li><li>Add-On owner.</li><li>Requested Add-On unique quota ID.</li><li>Additional information that would help qualify the ask, including goals,
timelines, etc., you might have in mind.</li></ul></li><li>You will need at least your PM and the OCM PM&rsquo;s to sign off before the SKU
is created. We expect to resolve these requests within 7 working days.</li></ul><h2 id=requesting-sku-attributes-changes>Requesting SKU Attributes Changes</h2><p>From time to time you may want to update some SKU fields like supported cloud providers,
quota cost, product support, etc. To do this:</p><ul><li>Create a JIRA Request at <a href=https://issues.redhat.com/projects/SDB/>Service Dev Team B</a></li><li>Ping the ticket in #service-development-b Slack channel (@sd-b-team is the handle)</li><li>This requires an update to be committed in-code in AMS, then deployed to stage and
eventually prod (allow up to 7 working days).</li></ul><h2 id=current-status>Current Status</h2><p>To check current SKUs and attributes, see
<a href="https://docs.google.com/spreadsheets/d/1HGvQnahZCxb_zYH2kSnnTFsxy9MM49vywd-P0X_ISLA/edit#gid=1479779350">OCM Resource Cost Mappings</a>.</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.3bff53fa2e8d9a2c4d0b3eeea5987ff2f2cc9a0f4eccb730274827d5e7cd5538.js integrity="sha256-O/9T+i6NmixNCz7upZh/8vLMmg9OzLcwJ0gn1efNVTg=" crossorigin=anonymous></script></body></html>