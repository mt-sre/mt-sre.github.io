<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.115.3"><link rel=canonical type=text/html href=/docs/creating-addons/top-level-operator/><link rel=alternate type=application/rss+xml href=/docs/creating-addons/top-level-operator/index.xml><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon.png sizes=180x180><link rel=icon type=image/png href=/favicons/android-chrome-192x192.png sizes=192x192><link rel=icon type=image/png href=/favicons/android-chrome-512x512.png sizes=512x512><title>Top Level Operator | Layered Products SRE</title><meta name=description content="Top Level Operator.
"><meta property="og:title" content="Top Level Operator"><meta property="og:description" content="Top Level Operator.
"><meta property="og:type" content="website"><meta property="og:url" content="/docs/creating-addons/top-level-operator/"><meta itemprop=name content="Top Level Operator"><meta itemprop=description content="Top Level Operator.
"><meta name=twitter:card content="summary"><meta name=twitter:title content="Top Level Operator"><meta name=twitter:description content="Top Level Operator.
"><link rel=preload href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css as=style><link href=/scss/main.min.0799d219d5950ac36000bb078e915525f0e42b82cd2a4e21fbeb9a6015fc5ef0.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.8/lunr.min.js integrity=sha384-vRQ9bDyE0Wnu+lMfm57BlYLO0/XauFuKpVsZPs7KEDwYKktWi5+Kz3MP8++DFlRY crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo></span><span class=font-weight-bold>Layered Products SRE</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/docs/internal-documentation/access/><span>Getting Access</span></a></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.9d5355696b6fca5b7d4a71985b0d8b71.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/creating-addons/top-level-operator/>Return to the regular view of this page</a>.</p></div><h1 class=title>Top Level Operator</h1><div class=lead>Top Level Operator.</div><ul><li>1: <a href=#pg-25e4bd9f4a45c4e388bb613552bfe306>Customer Notifications</a></li><li>2: <a href=#pg-15a051846993924e91e0c5036e5a9d13>Dependencies</a></li><li>3: <a href=#pg-ce4044d66e5c02b22c9304d1267066c3>Environments</a></li><li>4: <a href=#pg-308672f4c12b7c8c41437bb58bcfbc7d>Plug and Play Addon</a></li></ul><div class=content></div></div><div class=td-content><h1 id=pg-25e4bd9f4a45c4e388bb613552bfe306>1 - Customer Notifications</h1><h2 id=status-page>Status Page</h2><p><a href=https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/app-sre/statuspage.md>https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/app-sre/statuspage.md</a></p><p><a href=https://service.pages.redhat.com/dev-guidelines/docs/appsre/advanced/statuspage/>https://service.pages.redhat.com/dev-guidelines/docs/appsre/advanced/statuspage/</a></p><h2 id=service-logs>Service Logs</h2><p><a href=https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/blob/main/MT-SRE/sops/mt-sre-customer-notification.md>https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/blob/main/MT-SRE/sops/mt-sre-customer-notification.md</a></p><h2 id=internal-email>Internal Email</h2><p>There are multiple ways a user or group can get notified of service events (e.g.
planned maintenance, outages). There are two fields in the addon metadata file
(see Add-On metadata file <a href=https://github.com/mt-sre/managed-tenants-cli/blob/main/docs/tenants/zz_metadata_schema_generated.md>schema documentation</a>
for more information) where email addresses can be provided:</p><ul><li><code>addonOwner</code>: <em>REQUIRED</em> Point of contact for communications from Service Delivery to
addon owners. Where possible, this should be a development team mailing list
(rather than an individual developer).</li><li><code>addonNotifications</code>: This is a list of additional email addresses of
employees who would like to receive notifications about a service.</li></ul><p>There is also a mailing list that receives notifications for all services managed
by Service Delivery. Subscribe to the sd-notifications mailing list
<a href=https://post-office.corp.redhat.com/mailman/listinfo/sd-notifications>here</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-15a051846993924e91e0c5036e5a9d13>2 - Dependencies</h1><p>This document describes the supported implementation for Addon dependencies,
as signed-off by the Managed Tenants SRE Team.</p><h2 id=dependencies-specification>Dependencies Specification</h2><ul><li>Addons must specify dependencies using the OLM dependencies feature,
documented <a href=https://docs.openshift.com/container-platform/4.7/operators/understanding/olm/olm-understanding-dependency-resolution.html>here</a></li><li>The dependencies must have the version pin-pointed. Ranges are not allowed.</li><li>The dependencies must come from a <em>Trusted Catalog</em>. See the
<a href=#trusted-catalogs>Trusted Catalogs</a> section for details.</li></ul><h2 id=trusted-catalogs>Trusted Catalogs</h2><p>The Addon and its dependencies must come from Trusted Catalogs. Trusted
Catalogs are those with content published by the Managed Services Pipelines,
implemented by CPaaS, or by the Managed Tenants SRE Team.</p><h3 id=trusted-catalogs-list>Trusted Catalogs List</h3><ul><li>Addon catalog: the catalog created by the Managed Tenants SRE Team, for the
purpose of releasing the Addon. Dependency bundles can be shipped in the same
catalog of the Addon. The Addon catalog is considered &ldquo;trusted&rdquo; for
the dependencies it carries.</li><li>Red Hat Operators catalog: the catalog content goes through the Managed
Services Pipelines, same process to build some Addons themselves, just with
a different release process. This catalog is considered &ldquo;trusted&rdquo; and can be
used for dependencies.</li></ul><h3 id=including-a-catalog-in-the-trusted-list>Including a Catalog in the Trusted List</h3><ul><li>Make sure that the catalog is available on OSD and its content is released
through the Managed Services Pipelines, implemented by CPaaS.</li><li>Create a Jira ticket in the
<a href="https://issues.redhat.com/secure/CreateIssue.jspa?pid=12326231&amp;issuetype=3">MT-SRE Team backlog</a>,
requesting the assessment of the OSD catalog you want to consider as
&ldquo;trusted&rdquo;.</li></ul><h2 id=issues>Issues</h2><p>There&rsquo;s a feature request to the OLM Team to allow specifying the
CatalogSource used for the dependencies:</p><ul><li><a href=https://issues.redhat.com/browse/OLM-2249>OLM-2249</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ce4044d66e5c02b22c9304d1267066c3>3 - Environments</h1><h2 id=mandatory-environments>Mandatory environments</h2><p>Add-ons are normally deployed to two environments:</p><ul><li><code>ocm stage</code>: development/testing - All add-ons <strong>must</strong> deploy to this
environment before being released to production.</li><li><code>ocm production</code>: once the deployment in stage has been reviewed,
accepted, and approved it can be promoted to production via <code>/lgtm</code> by
your SRE team.</li></ul><p>We recommend the <code>ocm stage</code> and <code>ocm production</code> add-on metadata be as
similar as possible.</p><h2 id=slos>SLOs</h2><p><code>ocm stage</code> have no SLO and operates with best effort support from Add-on SRE,
SREP, and App-SRE
<code>osd stage cluster</code> have no SLO and operates with best effort support from Add-on
SRE, SREP, and App-SRE
<code>ocm production</code> environments are subject to App-SRE <a href=https://gitlab.cee.redhat.com/app-sre/contract/-/blob/master/README.md#appsre-service-level-objectives>SLOs</a>.
<code>osd production cluster</code> environments are subject OSD <a href=https://source.redhat.com/groups/public/openshiftplatformsre/wiki/faq_openshift_dedicated_service_level_objectives>SLOs</a>.</p><h2 id=additional-environments-via-duplicate-add-ons>Additional Environments (via duplicate add-ons)</h2><p>Some add-on providers have had use cases which require additional add-on envs.
While we only have <code>ocm stage</code> and <code>ocm prod</code>, managed-tenants may be leveraged
to deploy to an additional add-on (like edge or internal). Today we don&rsquo;t recommend
this practice due to the need to clone all add-on metadata which increases the
risk for incorrect metadata going to production/customer clusters.</p><p>If you need to do the above, please reach out to your assigned SRE team for
guidance first.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-308672f4c12b7c8c41437bb58bcfbc7d>4 - Plug and Play Addon</h1><h2 id=package-operator>Package Operator</h2><p>Package Operator is a Kubernetes Operator for packaging and managing a collection of arbitrary Kubernetes objects.</p><p>Each addon with a <code>packageOperator</code> defined in its <code>spec</code> will have a corresponding
<a href=https://package-operator.run/docs/getting_started/api-reference/#clusterobjecttemplate>ClusterObjectTemplate</a>.
The ClusterObjectTemplate is an API defined in Package
Operator, enabling users to create an object by templating a
manifest and injecting values retrieved from other arbitrary source objects.
However, regular users typically do not need to interact with the <code>ClusterObjectTemplate</code>.
Instead, they can interact with the generated
<a href=https://package-operator.run/docs/getting_started/api-reference/#clusterpackage>ClusterPackage</a>
manifest.</p><p><strong>Example of a <code>ClusterPackage</code> manifest:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>apiVersion: package-operator.run/v1alpha1
</span></span><span style=display:flex><span>kind: ClusterPackage
</span></span><span style=display:flex><span>metadata:
</span></span><span style=display:flex><span>  name: &lt;addon_name&gt;
</span></span><span style=display:flex><span>spec:
</span></span><span style=display:flex><span>  image: &lt;addon.spec.packageOperator&gt;
</span></span><span style=display:flex><span>   config:
</span></span><span style=display:flex><span>    addonsv1:
</span></span><span style=display:flex><span>      clusterID: a440b136-b2d6-406b-a884-fca2d62cd170
</span></span><span style=display:flex><span>      deadMansSnitchUrl: https://example.com/test-snitch-url
</span></span><span style=display:flex><span>      ocmClusterID: abc123
</span></span><span style=display:flex><span>      ocmClusterName: asdf
</span></span><span style=display:flex><span>      pagerDutyKey: 1234567890ABCDEF
</span></span><span style=display:flex><span>      parameters:
</span></span><span style=display:flex><span>        foo1: bar
</span></span><span style=display:flex><span>        foo2: baz
</span></span><span style=display:flex><span>      targetNamespace: pko-test-ns-00-req-apy-dsy-pdy
</span></span></code></pre></div><ul><li><p>The <code>deadMansSnitchUrl</code> and <code>pagerDutyKey</code> are obtained
from the ConfigMaps using their default names and locations.
<strong>IMPORTANT:</strong> To successfully inject the <code>deadMansSnitchUrl</code> and <code>pagerDutyKey</code> values into the <code>ClusterPackage</code> manifest,
you must keep the default naming scheme and location of the corresponding ConfigMaps.
See the <a href=https://mt-sre.github.io/docs/creating-addons/monitoring/deadmanssnitch_integration/>addons deadMansSnitch</a>
and <a href=https://mt-sre.github.io/docs/creating-addons/monitoring/pagerduty_integration/>addons pagerDuty</a>
documentation for more information.</p></li><li><p>Additionally, all the values present in <code>.spec.config.addonsv1</code>
can be injected into the objects within your packageImage.
See the
<a href=https://package-operator.run/docs/guides/packaging-an-application/#go-templates>package operator</a>
documentation for more information.</p></li></ul><h2 id=tenants-onboarding-steps>Tenants Onboarding Steps</h2><p>Although you can generate the packageImage yourself using the
<a href=https://package-operator.run/docs/guides/packaging-an-application/#build--validate>package operator</a> documentation,
we recommend you use the Managed Tenants Bundles (MTB) facilities.</p><p>The following steps are an example of generating the packageImage for the reference-addon package using the MTB flow:</p><ol><li><p>In the MTB repository, create a <code>package</code> directory and add the <code>manifests.yaml</code> inside the <code>package</code> directory.
See the following
<a href=https://gitlab.cee.redhat.com/service/managed-tenants-bundles/-/tree/main/addons/reference-addon/package>merge request</a>
for an example.</p></li><li><p>The MTB CI creates the packageImage and the Operator Lifecycle Manager (OLM) Index Image as part of the team&rsquo;s
<a href=https://gitlab.cee.redhat.com/service/managed-tenants-bundles/-/tree/main/addons/reference-addon>addon folder</a>.</p></li><li><p>The MTB CI creates a merge request to the
<a href=https://gitlab.cee.redhat.com/service/managed-tenants/-/blob/main/addons/reference-addon/addonimagesets/stage/reference-addon.v0.10.1.yaml#L24>managed-tenants repository</a>
and adds a new AddonImageSet with the PackageImage and OLM Index images.</p></li></ol></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.3bff53fa2e8d9a2c4d0b3eeea5987ff2f2cc9a0f4eccb730274827d5e7cd5538.js integrity="sha256-O/9T+i6NmixNCz7upZh/8vLMmg9OzLcwJ0gn1efNVTg=" crossorigin=anonymous></script></body></html>